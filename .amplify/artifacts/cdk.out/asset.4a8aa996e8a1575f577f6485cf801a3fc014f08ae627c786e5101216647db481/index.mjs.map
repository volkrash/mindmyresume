{
  "version": 3,
  "sources": ["../../../../node_modules/@aws-amplify/backend-function/src/lambda-shims/cjs_shim.ts", "../../../../amplify/functions/rewriteResume/handler.js"],
  "sourcesContent": ["import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport url from 'node:url';\nglobal.require = createRequire(import.meta.url);\nglobal.__filename = url.fileURLToPath(import.meta.url);\nglobal.__dirname = path.dirname(__filename);\n", "// amplify/functions/rewriteResume/handler.js\n\nconst OPENAI_API_KEY = process.env.OPENAI_API_KEY;\n\n/*function corsHeaders() {\n    return {\n        \"Content-Type\": \"application/json\",\n        \"Access-Control-Allow-Origin\": \"*\",\n        \"Access-Control-Allow-Headers\": \"Content-Type\",\n        \"Access-Control-Allow-Methods\": \"OPTIONS,POST\",\n    };\n}*/\n\nasync function callOpenAI(body) {\n    if (!OPENAI_API_KEY) {\n        throw new Error(\"Missing OPENAI_API_KEY\");\n    }\n\n    const { resumeText, jobDescription, language, mode } = body;\n\n    const systemPrompt = `\nYou are a professional r\u00E9sum\u00E9 writer.\n\nGOALS:\n- Rewrite the resume so it is ATS-friendly AND visually clean.\n- Use clear section headings (e.g. PROFESSIONAL PROFILE, EXPERIENCE, EDUCATION, SKILLS).\n- Write concise, impact-focused bullet points with metrics where possible.\n\nSTRICT FORMAT RULES:\n- NO ASCII art.\n- NO decorative lines made of repeated characters (no \"-----\", \"*****\", \"______\" etc.).\n- Do NOT surround headings with asterisks or dashes.\n- Use normal capitalization and spacing.\n- Bullet points should use a simple bullet like \"\u2022 \" at the beginning of the line.\n- Preserve logical paragraph and section spacing.\n\nOUTPUT:\nReturn ONLY valid JSON with this shape:\n\n{\n  \"templateId\": \"modern-clean-1\",\n  \"content\": \"FINAL RESUME AS PLAIN TEXT, WITH GOOD SPACING AND BULLETS ONLY USING '\u2022 '\",\n  \"structured\": null\n}\n\n\"structured\" is reserved for future use; you may return null for now.\nIf the user language is Spanish, write the r\u00E9sum\u00E9 in Spanish; otherwise in English.\nIf mode is \"federal\", keep standard format (we will specialize federal later).\n  `.trim();\n\n    const userPrompt = `\nLanguage: ${language || \"en\"}\nMode: ${mode || \"standard\"}\n\nJob description (optional):\n${jobDescription || \"(none provided)\"}\n\nOriginal resume:\n${resumeText}\n`.trim();\n\n    const resp = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n        method: \"POST\",\n        headers: {\n            Authorization: `Bearer ${OPENAI_API_KEY}`,\n            \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n            model: \"gpt-4.1-mini\",\n            messages: [\n                { role: \"system\", content: systemPrompt },\n                { role: \"user\", content: userPrompt },\n            ],\n            temperature: 0.4,\n        }),\n    });\n\n    if (!resp.ok) {\n        const errorText = await resp.text();\n        console.error(\"OpenAI error:\", resp.status, errorText);\n        throw new Error(`OpenAI error ${resp.status}: ${errorText}`);\n    }\n\n    const json = await resp.json();\n    const raw = json.choices?.[0]?.message?.content || \"\";\n\n    let parsed;\n    try {\n        parsed = JSON.parse(raw);\n    } catch (e) {\n        console.error(\"Failed to parse OpenAI JSON. Raw content:\", raw, e);\n        // fallback: wrap as basic shape\n        parsed = {\n            templateId: \"modern-clean-1\",\n            content: raw,\n            structured: null,\n        };\n    }\n\n    return parsed;\n}\n\nexport const handler = async (event) => {\n    try {\n        if (event.requestContext?.http?.method === \"OPTIONS\") {\n            return {\n                statusCode: 204,\n                headers: corsHeaders(),\n                body: \"\",\n            };\n        }\n\n        if (!event.body) {\n            return {\n                statusCode: 400,\n                headers: corsHeaders(),\n                body: JSON.stringify({ error: \"Missing body\" }),\n            };\n        }\n\n        let parsedBody;\n        try {\n            parsedBody =\n                typeof event.body === \"string\"\n                    ? JSON.parse(event.body || \"{}\")\n                    : event.body || {};\n        } catch (e) {\n            console.error(\"Invalid JSON body:\", e);\n            return {\n                statusCode: 400,\n                headers: corsHeaders(),\n                body: JSON.stringify({ error: \"Invalid JSON body\" }),\n            };\n        }\n\n        const { resumeText } = parsedBody;\n        if (!resumeText || typeof resumeText !== \"string\") {\n            return {\n                statusCode: 400,\n                headers: corsHeaders(),\n                body: JSON.stringify({ error: \"resumeText is required\" }),\n            };\n        }\n\n        const aiResult = await callOpenAI(parsedBody);\n\n        return {\n            statusCode: 200,\n            headers: corsHeaders(),\n            body: JSON.stringify(aiResult),\n        };\n    } catch (err) {\n        console.error(\"Rewrite Lambda error:\", err);\n        return {\n            statusCode: 500,\n            headers: corsHeaders(),\n            body: JSON.stringify({\n                error: \"INTERNAL_ERROR\",\n                details: String(err && err.message ? err.message : err),\n            }),\n        };\n    }\n};\n"],
  "mappings": "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",
  "names": ["createRequire", "path", "url", "OPENAI_API_KEY", "callOpenAI", "body", "resumeText", "jobDescription", "language", "mode", "systemPrompt", "userPrompt", "resp", "errorText", "raw", "parsed", "e", "handler", "event", "parsedBody", "aiResult", "err"]
}
