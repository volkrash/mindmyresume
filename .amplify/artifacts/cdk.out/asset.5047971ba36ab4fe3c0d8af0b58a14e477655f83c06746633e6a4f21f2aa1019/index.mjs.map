{
  "version": 3,
  "sources": ["../../../../node_modules/@aws-amplify/backend-function/src/lambda-shims/cjs_shim.ts", "../../../../amplify/functions/rewriteResume/handler.js"],
  "sourcesContent": ["import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport url from 'node:url';\nglobal.require = createRequire(import.meta.url);\nglobal.__filename = url.fileURLToPath(import.meta.url);\nglobal.__dirname = path.dirname(__filename);\n", "// amplify/functions/rewriteResume/handler.js\n\n// Main Lambda handler (CommonJS, no TypeScript)\nexports.handler = async (event) => {\n    // Handle preflight OPTIONS for CORS\n    if (event.requestContext && event.requestContext.http && event.requestContext.http.method === \"OPTIONS\") {\n        return cors(200, { ok: true });\n    }\n\n    try {\n        const apiKey = process.env.OPENAI_API_KEY;\n        if (!apiKey) {\n            return cors(500, { error: \"OPENAI_API_KEY not set\" });\n        }\n\n        // Parse JSON body safely\n        let body = {};\n        try {\n            if (typeof event.body === \"string\") {\n                body = JSON.parse(event.body);\n            } else if (event.body) {\n                body = event.body;\n            }\n        } catch (e) {\n            console.log(\"Failed to parse body:\", e);\n            return cors(400, { error: \"Invalid JSON body\" });\n        }\n\n        const resumeText = (body.resumeText || \"\").toString();\n        const jobDescription = (body.jobDescription || \"\").toString();\n        const language = (body.language || \"en\").toString();\n\n        if (!resumeText.trim()) {\n            return cors(400, { error: \"resumeText is required\" });\n        }\n\n        const systemPrompt =\n            language === \"es\"\n                ? \"Eres un experto en redacci\u00F3n de curr\u00EDculums. Reescribe el curr\u00EDculum del usuario en un formato claro, profesional y enfocado en logros. Usa vi\u00F1etas cuando sea apropiado. Mant\u00E9n el contenido apto para sistemas ATS.\"\n                : \"You are an expert resume writer. Rewrite the user's resume into a clear, professional, achievement-focused format. Use bullet points where appropriate. Keep the content ATS-friendly.\";\n\n        const userPrompt =\n            (language === \"es\" ? \"Curr\u00EDculum original:\\n\\n\" : \"Original resume:\\n\\n\") +\n            resumeText +\n            \"\\n\\n\" +\n            (jobDescription\n                ? (language === \"es\"\n                    ? \"Descripci\u00F3n del puesto objetivo:\\n\\n\"\n                    : \"Target job description:\\n\\n\") +\n                jobDescription +\n                \"\\n\\n\"\n                : \"\") +\n            (language === \"es\"\n                ? \"Reescribe el curr\u00EDculum para que se alinee con el puesto (si se proporcion\u00F3), manteniendo la veracidad de la informaci\u00F3n. Devu\u00E9lvelo en texto plano.\"\n                : \"Rewrite the resume so it aligns with the target role (if provided), keeping all facts true. Return plain text only.\");\n\n        // Call OpenAI via HTTP (Node 18+ has global fetch)\n        const openAiResponse = await fetch(\"https://api.openai.com/v1/chat/completions\", {\n            method: \"POST\",\n            headers: {\n                Authorization: `Bearer ${apiKey}`,\n                \"Content-Type\": \"application/json\",\n            },\n            body: JSON.stringify({\n                model: \"gpt-4.1-mini\",\n                messages: [\n                    { role: \"system\", content: systemPrompt },\n                    { role: \"user\", content: userPrompt },\n                ],\n                temperature: 0.4,\n            }),\n        });\n\n        const completionJson = await openAiResponse.json();\n\n        if (!openAiResponse.ok) {\n            console.error(\"OpenAI error:\", openAiResponse.status, completionJson);\n            return cors(502, {\n                error: \"OpenAI API error\",\n                status: openAiResponse.status,\n                details: completionJson,\n            });\n        }\n\n        const rewrittenText =\n            completionJson.choices &&\n            completionJson.choices[0] &&\n            completionJson.choices[0].message &&\n            completionJson.choices[0].message.content\n                ? completionJson.choices[0].message.content.trim()\n                : language === \"es\"\n                    ? \"No se pudo generar una respuesta.\"\n                    : \"No response generated.\";\n\n        return cors(200, { rewrittenText });\n    } catch (err) {\n        console.error(\"rewriteResume unexpected error:\", err);\n        return cors(500, {\n            error: \"Internal server error\",\n            details: err && err.message ? err.message : String(err),\n        });\n    }\n};\n\nfunction cors(statusCode, body) {\n    return {\n        statusCode,\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"Access-Control-Allow-Origin\": \"*\",\n            \"Access-Control-Allow-Headers\": \"*\",\n            \"Access-Control-Allow-Methods\": \"OPTIONS,POST\",\n        },\n        body: JSON.stringify(body),\n    };\n}\n"],
  "mappings": ";AAAA,OAAS,iBAAAA,MAAqB,cAC9B,OAAOC,MAAU,YACjB,OAAOC,MAAS,WAChB,OAAO,QAAUF,EAAc,YAAY,GAAG,EAC9C,OAAO,WAAaE,EAAI,cAAc,YAAY,GAAG,EACrD,OAAO,UAAYD,EAAK,QAAQ,UAAU,ECF1C,QAAQ,QAAU,MAAOE,GAAU,CAE/B,GAAIA,EAAM,gBAAkBA,EAAM,eAAe,MAAQA,EAAM,eAAe,KAAK,SAAW,UAC1F,OAAOC,EAAK,IAAK,CAAE,GAAI,EAAK,CAAC,EAGjC,GAAI,CACA,IAAMC,EAAS,QAAQ,IAAI,eAC3B,GAAI,CAACA,EACD,OAAOD,EAAK,IAAK,CAAE,MAAO,wBAAyB,CAAC,EAIxD,IAAIE,EAAO,CAAC,EACZ,GAAI,CACI,OAAOH,EAAM,MAAS,SACtBG,EAAO,KAAK,MAAMH,EAAM,IAAI,EACrBA,EAAM,OACbG,EAAOH,EAAM,KAErB,OAASI,EAAG,CACR,eAAQ,IAAI,wBAAyBA,CAAC,EAC/BH,EAAK,IAAK,CAAE,MAAO,mBAAoB,CAAC,CACnD,CAEA,IAAMI,GAAcF,EAAK,YAAc,IAAI,SAAS,EAC9CG,GAAkBH,EAAK,gBAAkB,IAAI,SAAS,EACtDI,GAAYJ,EAAK,UAAY,MAAM,SAAS,EAElD,GAAI,CAACE,EAAW,KAAK,EACjB,OAAOJ,EAAK,IAAK,CAAE,MAAO,wBAAyB,CAAC,EAGxD,IAAMO,EACFD,IAAa,KACP,uOACA,yLAEJE,GACDF,IAAa,KAAO;AAAA;AAAA,EAA6B;AAAA;AAAA,GAClDF,EACA;AAAA;AAAA,GACCC,GACMC,IAAa,KACV;AAAA;AAAA,EACA;AAAA;AAAA,GACND,EACA;AAAA;AAAA,EACE,KACLC,IAAa,KACR,mKACA,uHAGJG,EAAiB,MAAM,MAAM,6CAA8C,CAC7E,OAAQ,OACR,QAAS,CACL,cAAe,UAAUR,CAAM,GAC/B,eAAgB,kBACpB,EACA,KAAM,KAAK,UAAU,CACjB,MAAO,eACP,SAAU,CACN,CAAE,KAAM,SAAU,QAASM,CAAa,EACxC,CAAE,KAAM,OAAQ,QAASC,CAAW,CACxC,EACA,YAAa,EACjB,CAAC,CACL,CAAC,EAEKE,EAAiB,MAAMD,EAAe,KAAK,EAEjD,GAAI,CAACA,EAAe,GAChB,eAAQ,MAAM,gBAAiBA,EAAe,OAAQC,CAAc,EAC7DV,EAAK,IAAK,CACb,MAAO,mBACP,OAAQS,EAAe,OACvB,QAASC,CACb,CAAC,EAGL,IAAMC,EACFD,EAAe,SACfA,EAAe,QAAQ,CAAC,GACxBA,EAAe,QAAQ,CAAC,EAAE,SAC1BA,EAAe,QAAQ,CAAC,EAAE,QAAQ,QAC5BA,EAAe,QAAQ,CAAC,EAAE,QAAQ,QAAQ,KAAK,EAC/CJ,IAAa,KACT,oCACA,yBAEd,OAAON,EAAK,IAAK,CAAE,cAAAW,CAAc,CAAC,CACtC,OAASC,EAAK,CACV,eAAQ,MAAM,kCAAmCA,CAAG,EAC7CZ,EAAK,IAAK,CACb,MAAO,wBACP,QAASY,GAAOA,EAAI,QAAUA,EAAI,QAAU,OAAOA,CAAG,CAC1D,CAAC,CACL,CACJ,EAEA,SAASZ,EAAKa,EAAYX,EAAM,CAC5B,MAAO,CACH,WAAAW,EACA,QAAS,CACL,eAAgB,mBAChB,8BAA+B,IAC/B,+BAAgC,IAChC,+BAAgC,cACpC,EACA,KAAM,KAAK,UAAUX,CAAI,CAC7B,CACJ",
  "names": ["createRequire", "path", "url", "event", "cors", "apiKey", "body", "e", "resumeText", "jobDescription", "language", "systemPrompt", "userPrompt", "openAiResponse", "completionJson", "rewrittenText", "err", "statusCode"]
}
