/** * Reads SSM environment context from a known Amplify environment variable, * fetches values from SSM and places those values in the corresponding environment variables */export const internalAmplifyFunctionResolveSsmParams = async (client) => {    const envPathObject = JSON.parse(process.env.AMPLIFY_SSM_ENV_CONFIG ?? '{}');    const paths = Object.values(envPathObject).map((paths) => paths.path);    if (paths.length === 0) {        return;    }    let actualSsmClient;    if (client) {        actualSsmClient = client;    }    else {        const ssmSdk = await import('@aws-sdk/client-ssm');        actualSsmClient = new ssmSdk.SSM();    }    const chunkArray = (array, chunkSize) => {        const chunks = [];        for (let i = 0; i < array.length; i += chunkSize) {            chunks.push(array.slice(i, i + chunkSize));        }        return chunks;    };    const resolveSecrets = async (paths) => {        const response = (await Promise.all(chunkArray(paths, 10).map(async (chunkedPaths) => await actualSsmClient.getParameters({            Names: chunkedPaths,            WithDecryption: true,        })))).reduce((accumulator, res) => {            accumulator.Parameters?.push(...(res.Parameters ?? []));            accumulator.InvalidParameters?.push(...(res.InvalidParameters ?? []));            return accumulator;        }, {            Parameters: [],            InvalidParameters: [],        });        if (response.Parameters && response.Parameters.length > 0) {            for (const parameter of response.Parameters) {                if (parameter.Name) {                    const envKey = Object.keys(envPathObject).find((key) => envPathObject[key].sharedPath === parameter.Name ||                        envPathObject[key].path === parameter.Name);                    if (envKey) {                        process.env[envKey] = parameter.Value;                    }                }            }        }        return response;    };    const response = await resolveSecrets(paths);    const sharedPaths = (response?.InvalidParameters || [])        .map((invalidParam) => Object.values(envPathObject).find((paths) => paths.path === invalidParam)?.sharedPath)        .filter((sharedParam) => !!sharedParam);     if (sharedPaths.length > 0) {        await resolveSecrets(sharedPaths);    }};await internalAmplifyFunctionResolveSsmParams();const SSM_PARAMETER_REFRESH_MS = 1000 * 60;setInterval(async () => {    try {        await internalAmplifyFunctionResolveSsmParams();    }    catch (error) {        try {                        console.debug(error);                    }        catch {                    }    }}, SSM_PARAMETER_REFRESH_MS);export {};
var du=(r,e)=>()=>(r&&(e=r(r=0)),e);var u=(r,e)=>()=>(e||r((e={exports:{}}).exports,e),e.exports);import{createRequire as hu}from"node:module";import fu from"node:path";import pu from"node:url";var o=du(()=>{global.require=hu(import.meta.url);global.__filename=pu.fileURLToPath(import.meta.url);global.__dirname=fu.dirname(__filename)});var A=u(_e=>{"use strict";o();Object.defineProperty(_e,"__esModule",{value:!0});_e.__setModuleDefault=_e.__createBinding=void 0;_e.__classPrivateFieldSet=_u;_e.__classPrivateFieldGet=mu;_e.__exportStar=gu;_e.__importStar=bu;function _u(r,e,t,s,n){if(s==="m")throw new TypeError("Private method is not writable");if(s==="a"&&!n)throw new TypeError("Private accessor was defined without a setter");if(typeof e=="function"?r!==e||!n:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return s==="a"?n.call(r,t):n?n.value=t:e.set(r,t),t}function mu(r,e,t,s){if(t==="a"&&!s)throw new TypeError("Private accessor was defined without a getter");if(typeof e=="function"?r!==e||!s:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return t==="m"?s:t==="a"?s.call(r):s?s.value:e.get(r)}var Hn=Object.create?function(r,e,t,s){s===void 0&&(s=t);var n=Object.getOwnPropertyDescriptor(e,t);(!n||("get"in n?!e.__esModule:n.writable||n.configurable))&&(n={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(r,s,n)}:function(r,e,t,s){s===void 0&&(s=t),r[s]=e[t]};_e.__createBinding=Hn;function gu(r,e){for(var t in r)t!=="default"&&!Object.prototype.hasOwnProperty.call(e,t)&&Hn(e,r,t)}var oc=Object.create?function(r,e){Object.defineProperty(r,"default",{enumerable:!0,value:e})}:function(r,e){r.default=e};_e.__setModuleDefault=oc;var Un=function(r){return Un=Object.getOwnPropertyNames||function(e){var t=[];for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&(t[t.length]=s);return t},Un(r)};function bu(r){if(r&&r.__esModule)return r;var e={};if(r!=null)for(var t=Un(r),s=0;s<t.length;s++)t[s]!=="default"&&Hn(e,r,t[s]);return oc(e,r),e}});var Dn=u(lt=>{"use strict";o();Object.defineProperty(lt,"__esModule",{value:!0});lt.uuid4=void 0;var yu=function(){let{crypto:r}=globalThis;if(r?.randomUUID)return lt.uuid4=r.randomUUID.bind(r),r.randomUUID();let e=new Uint8Array(1),t=r?()=>r.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,s=>(+s^t()&15>>+s/4).toString(16))};lt.uuid4=yu});var sr=u(ut=>{"use strict";o();Object.defineProperty(ut,"__esModule",{value:!0});ut.castToError=void 0;ut.isAbortError=Pu;function Pu(r){return typeof r=="object"&&r!==null&&("name"in r&&r.name==="AbortError"||"message"in r&&String(r.message).includes("FetchRequestCanceledException"))}var vu=r=>{if(r instanceof Error)return r;if(typeof r=="object"&&r!==null){try{if(Object.prototype.toString.call(r)==="[object Error]"){let e=new Error(r.message,r.cause?{cause:r.cause}:{});return r.stack&&(e.stack=r.stack),r.cause&&!e.cause&&(e.cause=r.cause),r.name&&(e.name=r.name),e}}catch{}try{return new Error(JSON.stringify(r))}catch{}}return new Error(r)};ut.castToError=vu});var me=u(O=>{"use strict";o();Object.defineProperty(O,"__esModule",{value:!0});O.InvalidWebhookSignatureError=O.ContentFilterFinishReasonError=O.LengthFinishReasonError=O.InternalServerError=O.RateLimitError=O.UnprocessableEntityError=O.ConflictError=O.NotFoundError=O.PermissionDeniedError=O.AuthenticationError=O.BadRequestError=O.APIConnectionTimeoutError=O.APIConnectionError=O.APIUserAbortError=O.APIError=O.OpenAIError=void 0;var wu=sr(),De=class extends Error{};O.OpenAIError=De;var ie=class r extends De{constructor(e,t,s,n){super(`${r.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t;let i=t;this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,s){let n=t?.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new dt({message:s,cause:(0,wu.castToError)(t)});let i=t?.error;return e===400?new nr(e,i,s,n):e===401?new ir(e,i,s,n):e===403?new or(e,i,s,n):e===404?new ar(e,i,s,n):e===409?new cr(e,i,s,n):e===422?new lr(e,i,s,n):e===429?new ur(e,i,s,n):e>=500?new dr(e,i,s,n):new r(e,i,s,n)}};O.APIError=ie;var Wn=class extends ie{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}};O.APIUserAbortError=Wn;var dt=class extends ie{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}};O.APIConnectionError=dt;var Jn=class extends dt{constructor({message:e}={}){super({message:e??"Request timed out."})}};O.APIConnectionTimeoutError=Jn;var nr=class extends ie{};O.BadRequestError=nr;var ir=class extends ie{};O.AuthenticationError=ir;var or=class extends ie{};O.PermissionDeniedError=or;var ar=class extends ie{};O.NotFoundError=ar;var cr=class extends ie{};O.ConflictError=cr;var lr=class extends ie{};O.UnprocessableEntityError=lr;var ur=class extends ie{};O.RateLimitError=ur;var dr=class extends ie{};O.InternalServerError=dr;var Vn=class extends De{constructor(){super("Could not parse response content as the length limit was reached")}};O.LengthFinishReasonError=Vn;var Xn=class extends De{constructor(){super("Could not parse response content as the request was rejected by the content filter")}};O.ContentFilterFinishReasonError=Xn;var Kn=class extends Error{constructor(e){super(e)}};O.InvalidWebhookSignatureError=Kn});var Ae=u(I=>{"use strict";o();Object.defineProperty(I,"__esModule",{value:!0});I.safeJSON=I.maybeCoerceBoolean=I.maybeCoerceFloat=I.maybeCoerceInteger=I.coerceBoolean=I.coerceFloat=I.coerceInteger=I.validatePositiveInteger=I.ensurePresent=I.isReadonlyArray=I.isArray=I.isAbsoluteURL=void 0;I.maybeObj=Ou;I.isEmptyObj=qu;I.hasOwn=Ru;I.isObj=Cu;var ht=me(),Au=/^[a-z][a-z0-9+.-]*:/i,Su=r=>Au.test(r);I.isAbsoluteURL=Su;var Iu=r=>(I.isArray=Array.isArray,(0,I.isArray)(r));I.isArray=Iu;I.isReadonlyArray=I.isArray;function Ou(r){return typeof r!="object"?{}:r??{}}function qu(r){if(!r)return!0;for(let e in r)return!1;return!0}function Ru(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Cu(r){return r!=null&&typeof r=="object"&&!Array.isArray(r)}var Fu=r=>{if(r==null)throw new ht.OpenAIError(`Expected a value to be given but received ${r} instead.`);return r};I.ensurePresent=Fu;var Eu=(r,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new ht.OpenAIError(`${r} must be an integer`);if(e<0)throw new ht.OpenAIError(`${r} must be a positive integer`);return e};I.validatePositiveInteger=Eu;var xu=r=>{if(typeof r=="number")return Math.round(r);if(typeof r=="string")return parseInt(r,10);throw new ht.OpenAIError(`Could not coerce ${r} (type: ${typeof r}) into a number`)};I.coerceInteger=xu;var Mu=r=>{if(typeof r=="number")return r;if(typeof r=="string")return parseFloat(r);throw new ht.OpenAIError(`Could not coerce ${r} (type: ${typeof r}) into a number`)};I.coerceFloat=Mu;var Tu=r=>typeof r=="boolean"?r:typeof r=="string"?r==="true":!!r;I.coerceBoolean=Tu;var ju=r=>{if(r!=null)return(0,I.coerceInteger)(r)};I.maybeCoerceInteger=ju;var ku=r=>{if(r!=null)return(0,I.coerceFloat)(r)};I.maybeCoerceFloat=ku;var $u=r=>{if(r!=null)return(0,I.coerceBoolean)(r)};I.maybeCoerceBoolean=$u;var Nu=r=>{try{return JSON.parse(r)}catch{return}};I.safeJSON=Nu});var We=u(hr=>{"use strict";o();Object.defineProperty(hr,"__esModule",{value:!0});hr.sleep=void 0;var Gu=r=>new Promise(e=>setTimeout(e,r));hr.sleep=Gu});var zn=u(fr=>{"use strict";o();Object.defineProperty(fr,"__esModule",{value:!0});fr.VERSION=void 0;fr.VERSION="6.9.1"});var Qn=u(Je=>{"use strict";o();Object.defineProperty(Je,"__esModule",{value:!0});Je.getPlatformHeaders=Je.isRunningInBrowser=void 0;var ft=zn(),Bu=()=>typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u";Je.isRunningInBrowser=Bu;function Lu(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}var Uu=()=>{let r=Lu();if(r==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft.VERSION,"X-Stainless-OS":cc(Deno.build.os),"X-Stainless-Arch":ac(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(r==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft.VERSION,"X-Stainless-OS":cc(globalThis.process.platform??"unknown"),"X-Stainless-Arch":ac(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let e=Hu();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ft.VERSION,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function Hu(){if(typeof navigator>"u"||!navigator)return null;let r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(let{key:e,pattern:t}of r){let s=t.exec(navigator.userAgent);if(s){let n=s[1]||0,i=s[2]||0,a=s[3]||0;return{browser:e,version:`${n}.${i}.${a}`}}}return null}var ac=r=>r==="x32"?"x32":r==="x86_64"||r==="x64"?"x64":r==="arm"?"arm":r==="aarch64"||r==="arm64"?"arm64":r?`other:${r}`:"unknown",cc=r=>(r=r.toLowerCase(),r.includes("ios")?"iOS":r==="android"?"Android":r==="darwin"?"MacOS":r==="win32"?"Windows":r==="freebsd"?"FreeBSD":r==="openbsd"?"OpenBSD":r==="linux"?"Linux":r?`Other:${r}`:"Unknown"),lc,Du=()=>lc??(lc=Uu());Je.getPlatformHeaders=Du});var pt=u(xe=>{"use strict";o();Object.defineProperty(xe,"__esModule",{value:!0});xe.getDefaultFetch=Wu;xe.makeReadableStream=uc;xe.ReadableStreamFrom=Ju;xe.ReadableStreamToAsyncIterable=Vu;xe.CancelReadableStream=Xu;function Wu(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function uc(...r){let e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...r)}function Ju(r){let e=Symbol.asyncIterator in r?r[Symbol.asyncIterator]():r[Symbol.iterator]();return uc({start(){},async pull(t){let{done:s,value:n}=await e.next();s?t.close():t.enqueue(n)},async cancel(){await e.return?.()}})}function Vu(r){if(r[Symbol.asyncIterator])return r;let e=r.getReader();return{async next(){try{let t=await e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){let t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function Xu(r){if(r===null||typeof r!="object")return;if(r[Symbol.asyncIterator]){await r[Symbol.asyncIterator]().return?.();return}let e=r.getReader(),t=e.cancel();e.releaseLock(),await t}});var dc=u(pr=>{"use strict";o();Object.defineProperty(pr,"__esModule",{value:!0});pr.FallbackEncoder=void 0;var Ku=({headers:r,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});pr.FallbackEncoder=Ku});var _r=u(oe=>{"use strict";o();Object.defineProperty(oe,"__esModule",{value:!0});oe.RFC3986=oe.RFC1738=oe.formatters=oe.default_formatter=oe.default_format=void 0;oe.default_format="RFC3986";var zu=r=>String(r);oe.default_formatter=zu;oe.formatters={RFC1738:r=>String(r).replace(/%20/g,"+"),RFC3986:oe.default_formatter};oe.RFC1738="RFC1738";oe.RFC3986="RFC3986"});var hc=u(L=>{"use strict";o();Object.defineProperty(L,"__esModule",{value:!0});L.encode=L.has=void 0;L.merge=Zn;L.assign_single_source=td;L.decode=rd;L.compact=nd;L.is_regexp=id;L.is_buffer=od;L.combine=ad;L.maybe_map=cd;var Qu=_r(),Me=Ae(),Yu=(r,e)=>(L.has=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty),(0,L.has)(r,e));L.has=Yu;var ge=(()=>{let r=[];for(let e=0;e<256;++e)r.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return r})();function Zu(r){for(;r.length>1;){let e=r.pop();if(!e)continue;let t=e.obj[e.prop];if((0,Me.isArray)(t)){let s=[];for(let n=0;n<t.length;++n)typeof t[n]<"u"&&s.push(t[n]);e.obj[e.prop]=s}}}function ed(r,e){let t=e&&e.plainObjects?Object.create(null):{};for(let s=0;s<r.length;++s)typeof r[s]<"u"&&(t[s]=r[s]);return t}function Zn(r,e,t={}){if(!e)return r;if(typeof e!="object"){if((0,Me.isArray)(r))r.push(e);else if(r&&typeof r=="object")(t&&(t.plainObjects||t.allowPrototypes)||!(0,L.has)(Object.prototype,e))&&(r[e]=!0);else return[r,e];return r}if(!r||typeof r!="object")return[r].concat(e);let s=r;return(0,Me.isArray)(r)&&!(0,Me.isArray)(e)&&(s=ed(r,t)),(0,Me.isArray)(r)&&(0,Me.isArray)(e)?(e.forEach(function(n,i){if((0,L.has)(r,i)){let a=r[i];a&&typeof a=="object"&&n&&typeof n=="object"?r[i]=Zn(a,n,t):r.push(n)}else r[i]=n}),r):Object.keys(e).reduce(function(n,i){let a=e[i];return(0,L.has)(n,i)?n[i]=Zn(n[i],a,t):n[i]=a,n},s)}function td(r,e){return Object.keys(e).reduce(function(t,s){return t[s]=e[s],t},r)}function rd(r,e,t){let s=r.replace(/\+/g," ");if(t==="iso-8859-1")return s.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(s)}catch{return s}}var Yn=1024,sd=(r,e,t,s,n)=>{if(r.length===0)return r;let i=r;if(typeof r=="symbol"?i=Symbol.prototype.toString.call(r):typeof r!="string"&&(i=String(r)),t==="iso-8859-1")return escape(i).replace(/%u[0-9a-f]{4}/gi,function(c){return"%26%23"+parseInt(c.slice(2),16)+"%3B"});let a="";for(let c=0;c<i.length;c+=Yn){let l=i.length>=Yn?i.slice(c,c+Yn):i,h=[];for(let g=0;g<l.length;++g){let f=l.charCodeAt(g);if(f===45||f===46||f===95||f===126||f>=48&&f<=57||f>=65&&f<=90||f>=97&&f<=122||n===Qu.RFC1738&&(f===40||f===41)){h[h.length]=l.charAt(g);continue}if(f<128){h[h.length]=ge[f];continue}if(f<2048){h[h.length]=ge[192|f>>6]+ge[128|f&63];continue}if(f<55296||f>=57344){h[h.length]=ge[224|f>>12]+ge[128|f>>6&63]+ge[128|f&63];continue}g+=1,f=65536+((f&1023)<<10|l.charCodeAt(g)&1023),h[h.length]=ge[240|f>>18]+ge[128|f>>12&63]+ge[128|f>>6&63]+ge[128|f&63]}a+=h.join("")}return a};L.encode=sd;function nd(r){let e=[{obj:{o:r},prop:"o"}],t=[];for(let s=0;s<e.length;++s){let n=e[s],i=n.obj[n.prop],a=Object.keys(i);for(let c=0;c<a.length;++c){let l=a[c],h=i[l];typeof h=="object"&&h!==null&&t.indexOf(h)===-1&&(e.push({obj:i,prop:l}),t.push(h))}}return Zu(e),r}function id(r){return Object.prototype.toString.call(r)==="[object RegExp]"}function od(r){return!r||typeof r!="object"?!1:!!(r.constructor&&r.constructor.isBuffer&&r.constructor.isBuffer(r))}function ad(r,e){return[].concat(r,e)}function cd(r,e){if((0,Me.isArray)(r)){let t=[];for(let s=0;s<r.length;s+=1)t.push(e(r[s]));return t}return e(r)}});var gc=u(ti=>{"use strict";o();Object.defineProperty(ti,"__esModule",{value:!0});ti.stringify=dd;var _t=hc(),mt=_r(),be=Ae(),pc={brackets(r){return String(r)+"[]"},comma:"comma",indices(r,e){return String(r)+"["+e+"]"},repeat(r){return String(r)}},_c=function(r,e){Array.prototype.push.apply(r,(0,be.isArray)(e)?e:[e])},fc,U={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:_t.encode,encodeValuesOnly:!1,format:mt.default_format,formatter:mt.default_formatter,indices:!1,serializeDate(r){return(fc??(fc=Function.prototype.call.bind(Date.prototype.toISOString)))(r)},skipNulls:!1,strictNullHandling:!1};function ld(r){return typeof r=="string"||typeof r=="number"||typeof r=="boolean"||typeof r=="symbol"||typeof r=="bigint"}var ei={};function mc(r,e,t,s,n,i,a,c,l,h,g,f,b,d,S,y,N,E){let m=r,J=E,T=0,ne=!1;for(;(J=J.get(ei))!==void 0&&!ne;){let G=J.get(r);if(T+=1,typeof G<"u"){if(G===T)throw new RangeError("Cyclic object value");ne=!0}typeof J.get(ei)>"u"&&(T=0)}if(typeof h=="function"?m=h(e,m):m instanceof Date?m=b?.(m):t==="comma"&&(0,be.isArray)(m)&&(m=(0,_t.maybe_map)(m,function(G){return G instanceof Date?b?.(G):G})),m===null){if(i)return l&&!y?l(e,U.encoder,N,"key",d):e;m=""}if(ld(m)||(0,_t.is_buffer)(m)){if(l){let G=y?e:l(e,U.encoder,N,"key",d);return[S?.(G)+"="+S?.(l(m,U.encoder,N,"value",d))]}return[S?.(e)+"="+S?.(String(m))]}let Y=[];if(typeof m>"u")return Y;let k;if(t==="comma"&&(0,be.isArray)(m))y&&l&&(m=(0,_t.maybe_map)(m,l)),k=[{value:m.length>0?m.join(",")||null:void 0}];else if((0,be.isArray)(h))k=h;else{let G=Object.keys(m);k=g?G.sort(g):G}let V=c?String(e).replace(/\./g,"%2E"):String(e),X=s&&(0,be.isArray)(m)&&m.length===1?V+"[]":V;if(n&&(0,be.isArray)(m)&&m.length===0)return X+"[]";for(let G=0;G<k.length;++G){let B=k[G],nc=typeof B=="object"&&typeof B.value<"u"?B.value:m[B];if(a&&nc===null)continue;let Ln=f&&c?B.replace(/\./g,"%2E"):B,uu=(0,be.isArray)(m)?typeof t=="function"?t(X,Ln):X:X+(f?"."+Ln:"["+Ln+"]");E.set(r,T);let ic=new WeakMap;ic.set(ei,E),_c(Y,mc(nc,uu,t,s,n,i,a,c,t==="comma"&&y&&(0,be.isArray)(m)?null:l,h,g,f,b,d,S,y,N,ic))}return Y}function ud(r=U){if(typeof r.allowEmptyArrays<"u"&&typeof r.allowEmptyArrays!="boolean")throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(typeof r.encodeDotInKeys<"u"&&typeof r.encodeDotInKeys!="boolean")throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(r.encoder!==null&&typeof r.encoder<"u"&&typeof r.encoder!="function")throw new TypeError("Encoder has to be a function.");let e=r.charset||U.charset;if(typeof r.charset<"u"&&r.charset!=="utf-8"&&r.charset!=="iso-8859-1")throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let t=mt.default_format;if(typeof r.format<"u"){if(!(0,_t.has)(mt.formatters,r.format))throw new TypeError("Unknown format option provided.");t=r.format}let s=mt.formatters[t],n=U.filter;(typeof r.filter=="function"||(0,be.isArray)(r.filter))&&(n=r.filter);let i;if(r.arrayFormat&&r.arrayFormat in pc?i=r.arrayFormat:"indices"in r?i=r.indices?"indices":"repeat":i=U.arrayFormat,"commaRoundTrip"in r&&typeof r.commaRoundTrip!="boolean")throw new TypeError("`commaRoundTrip` must be a boolean, or absent");let a=typeof r.allowDots>"u"?r.encodeDotInKeys?!0:U.allowDots:!!r.allowDots;return{addQueryPrefix:typeof r.addQueryPrefix=="boolean"?r.addQueryPrefix:U.addQueryPrefix,allowDots:a,allowEmptyArrays:typeof r.allowEmptyArrays=="boolean"?!!r.allowEmptyArrays:U.allowEmptyArrays,arrayFormat:i,charset:e,charsetSentinel:typeof r.charsetSentinel=="boolean"?r.charsetSentinel:U.charsetSentinel,commaRoundTrip:!!r.commaRoundTrip,delimiter:typeof r.delimiter>"u"?U.delimiter:r.delimiter,encode:typeof r.encode=="boolean"?r.encode:U.encode,encodeDotInKeys:typeof r.encodeDotInKeys=="boolean"?r.encodeDotInKeys:U.encodeDotInKeys,encoder:typeof r.encoder=="function"?r.encoder:U.encoder,encodeValuesOnly:typeof r.encodeValuesOnly=="boolean"?r.encodeValuesOnly:U.encodeValuesOnly,filter:n,format:t,formatter:s,serializeDate:typeof r.serializeDate=="function"?r.serializeDate:U.serializeDate,skipNulls:typeof r.skipNulls=="boolean"?r.skipNulls:U.skipNulls,sort:typeof r.sort=="function"?r.sort:null,strictNullHandling:typeof r.strictNullHandling=="boolean"?r.strictNullHandling:U.strictNullHandling}}function dd(r,e={}){let t=r,s=ud(e),n,i;typeof s.filter=="function"?(i=s.filter,t=i("",t)):(0,be.isArray)(s.filter)&&(i=s.filter,n=i);let a=[];if(typeof t!="object"||t===null)return"";let c=pc[s.arrayFormat],l=c==="comma"&&s.commaRoundTrip;n||(n=Object.keys(t)),s.sort&&n.sort(s.sort);let h=new WeakMap;for(let b=0;b<n.length;++b){let d=n[b];s.skipNulls&&t[d]===null||_c(a,mc(t[d],d,c,l,s.allowEmptyArrays,s.strictNullHandling,s.skipNulls,s.encodeDotInKeys,s.encode?s.encoder:null,s.filter,s.sort,s.allowDots,s.serializeDate,s.format,s.formatter,s.encodeValuesOnly,s.charset,h))}let g=a.join(s.delimiter),f=s.addQueryPrefix===!0?"?":"";return s.charsetSentinel&&(s.charset==="iso-8859-1"?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),g.length>0?f+g:""}});var bc=u(Ve=>{"use strict";o();Object.defineProperty(Ve,"__esModule",{value:!0});Ve.formats=Ve.stringify=void 0;var mr=_r(),hd={formatters:mr.formatters,RFC1738:mr.RFC1738,RFC3986:mr.RFC3986,default:mr.default_format};Ve.formats=hd;var fd=gc();Object.defineProperty(Ve,"stringify",{enumerable:!0,get:function(){return fd.stringify}})});var gr=u(gt=>{"use strict";o();Object.defineProperty(gt,"__esModule",{value:!0});gt.concatBytes=pd;gt.encodeUTF8=_d;gt.decodeUTF8=md;function pd(r){let e=0;for(let n of r)e+=n.length;let t=new Uint8Array(e),s=0;for(let n of r)t.set(n,s),s+=n.length;return t}var yc;function _d(r){let e;return(yc??(e=new globalThis.TextEncoder,yc=e.encode.bind(e)))(r)}var Pc;function md(r){let e;return(Pc??(e=new globalThis.TextDecoder,Pc=e.decode.bind(e)))(r)}});var vc=u(yt=>{"use strict";o();var ae,ce;Object.defineProperty(yt,"__esModule",{value:!0});yt.LineDecoder=void 0;yt.findDoubleNewlineIndex=bd;var j=A(),br=gr(),bt=class{constructor(){ae.set(this,void 0),ce.set(this,void 0),j.__classPrivateFieldSet(this,ae,new Uint8Array,"f"),j.__classPrivateFieldSet(this,ce,null,"f")}decode(e){if(e==null)return[];let t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?(0,br.encodeUTF8)(e):e;j.__classPrivateFieldSet(this,ae,(0,br.concatBytes)([j.__classPrivateFieldGet(this,ae,"f"),t]),"f");let s=[],n;for(;(n=gd(j.__classPrivateFieldGet(this,ae,"f"),j.__classPrivateFieldGet(this,ce,"f")))!=null;){if(n.carriage&&j.__classPrivateFieldGet(this,ce,"f")==null){j.__classPrivateFieldSet(this,ce,n.index,"f");continue}if(j.__classPrivateFieldGet(this,ce,"f")!=null&&(n.index!==j.__classPrivateFieldGet(this,ce,"f")+1||n.carriage)){s.push((0,br.decodeUTF8)(j.__classPrivateFieldGet(this,ae,"f").subarray(0,j.__classPrivateFieldGet(this,ce,"f")-1))),j.__classPrivateFieldSet(this,ae,j.__classPrivateFieldGet(this,ae,"f").subarray(j.__classPrivateFieldGet(this,ce,"f")),"f"),j.__classPrivateFieldSet(this,ce,null,"f");continue}let i=j.__classPrivateFieldGet(this,ce,"f")!==null?n.preceding-1:n.preceding,a=(0,br.decodeUTF8)(j.__classPrivateFieldGet(this,ae,"f").subarray(0,i));s.push(a),j.__classPrivateFieldSet(this,ae,j.__classPrivateFieldGet(this,ae,"f").subarray(n.index),"f"),j.__classPrivateFieldSet(this,ce,null,"f")}return s}flush(){return j.__classPrivateFieldGet(this,ae,"f").length?this.decode(`
`):[]}};yt.LineDecoder=bt;ae=new WeakMap,ce=new WeakMap;bt.NEWLINE_CHARS=new Set([`
`,"\r"]);bt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function gd(r,e){for(let n=e??0;n<r.length;n++){if(r[n]===10)return{preceding:n,index:n+1,carriage:!1};if(r[n]===13)return{preceding:n,index:n+1,carriage:!0}}return null}function bd(r){for(let s=0;s<r.length-1;s++){if(r[s]===10&&r[s+1]===10||r[s]===13&&r[s+1]===13)return s+2;if(r[s]===13&&r[s+1]===10&&s+3<r.length&&r[s+2]===13&&r[s+3]===10)return s+4}return-1}});var vt=u(Te=>{"use strict";o();Object.defineProperty(Te,"__esModule",{value:!0});Te.formatRequestDetails=Te.parseLogLevel=void 0;Te.loggerFor=Ac;var yd=Ae(),Pr={off:0,error:200,warn:300,info:400,debug:500},Pd=(r,e,t)=>{if(r){if((0,yd.hasOwn)(Pr,r))return r;Ac(t).warn(`${e} was set to ${JSON.stringify(r)}, expected one of ${JSON.stringify(Object.keys(Pr))}`)}};Te.parseLogLevel=Pd;function Pt(){}function yr(r,e,t){return!e||Pr[r]>Pr[t]?Pt:e[r].bind(e)}var vd={error:Pt,warn:Pt,info:Pt,debug:Pt},wc=new WeakMap;function Ac(r){let e=r.logger,t=r.logLevel??"off";if(!e)return vd;let s=wc.get(e);if(s&&s[0]===t)return s[1];let n={error:yr("error",e,t),warn:yr("warn",e,t),info:yr("info",e,t),debug:yr("debug",e,t)};return wc.set(e,[t,n]),n}var wd=r=>(r.options&&(r.options={...r.options},delete r.options.headers),r.headers&&(r.headers=Object.fromEntries((r.headers instanceof Headers?[...r.headers]:Object.entries(r.headers)).map(([e,t])=>[e,e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in r&&(r.retryOfRequestLogID&&(r.retryOf=r.retryOfRequestLogID),delete r.retryOfRequestLogID),r);Te.formatRequestDetails=wd});var oi=u(At=>{"use strict";o();var wt;Object.defineProperty(At,"__esModule",{value:!0});At.Stream=void 0;At._iterSSEMessages=Rc;var ri=A(),vr=me(),Ad=pt(),ii=vc(),Oc=pt(),Sc=sr(),qc=gr(),Sd=vt(),Ic=me(),si=class r{constructor(e,t,s){this.iterator=e,wt.set(this,void 0),this.controller=t,ri.__classPrivateFieldSet(this,wt,s,"f")}static fromSSEResponse(e,t,s){let n=!1,i=s?(0,Sd.loggerFor)(s):console;async function*a(){if(n)throw new vr.OpenAIError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let c=!1;try{for await(let l of Rc(e,t))if(!c){if(l.data.startsWith("[DONE]")){c=!0;continue}if(l.event===null||!l.event.startsWith("thread.")){let h;try{h=JSON.parse(l.data)}catch(g){throw i.error("Could not parse message into JSON:",l.data),i.error("From chunk:",l.raw),g}if(h&&h.error)throw new Ic.APIError(void 0,h.error,void 0,e.headers);yield h}else{let h;try{h=JSON.parse(l.data)}catch(g){throw console.error("Could not parse message into JSON:",l.data),console.error("From chunk:",l.raw),g}if(l.event=="error")throw new Ic.APIError(void 0,h.error,h.message,void 0);yield{event:l.event,data:h}}}c=!0}catch(l){if((0,Sc.isAbortError)(l))return;throw l}finally{c||t.abort()}}return new r(a,t,s)}static fromReadableStream(e,t,s){let n=!1;async function*i(){let c=new ii.LineDecoder,l=(0,Oc.ReadableStreamToAsyncIterable)(e);for await(let h of l)for(let g of c.decode(h))yield g;for(let h of c.flush())yield h}async function*a(){if(n)throw new vr.OpenAIError("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let c=!1;try{for await(let l of i())c||l&&(yield JSON.parse(l));c=!0}catch(l){if((0,Sc.isAbortError)(l))return;throw l}finally{c||t.abort()}}return new r(a,t,s)}[(wt=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),n=i=>({next:()=>{if(i.length===0){let a=s.next();e.push(a),t.push(a)}return i.shift()}});return[new r(()=>n(e),this.controller,ri.__classPrivateFieldGet(this,wt,"f")),new r(()=>n(t),this.controller,ri.__classPrivateFieldGet(this,wt,"f"))]}toReadableStream(){let e=this,t;return(0,Ad.makeReadableStream)({async start(){t=e[Symbol.asyncIterator]()},async pull(s){try{let{value:n,done:i}=await t.next();if(i)return s.close();let a=(0,qc.encodeUTF8)(JSON.stringify(n)+`
`);s.enqueue(a)}catch(n){s.error(n)}},async cancel(){await t.return?.()}})}};At.Stream=si;async function*Rc(r,e){if(!r.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new vr.OpenAIError("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new vr.OpenAIError("Attempted to iterate over a response with no body");let t=new ni,s=new ii.LineDecoder,n=(0,Oc.ReadableStreamToAsyncIterable)(r.body);for await(let i of Id(n))for(let a of s.decode(i)){let c=t.decode(a);c&&(yield c)}for(let i of s.flush()){let a=t.decode(i);a&&(yield a)}}async function*Id(r){let e=new Uint8Array;for await(let t of r){if(t==null)continue;let s=t instanceof ArrayBuffer?new Uint8Array(t):typeof t=="string"?(0,qc.encodeUTF8)(t):t,n=new Uint8Array(e.length+s.length);n.set(e),n.set(s,e.length),e=n;let i;for(;(i=(0,ii.findDoubleNewlineIndex)(e))!==-1;)yield e.slice(0,i),e=e.slice(i)}e.length>0&&(yield e)}var ni=class{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let i={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=Od(e,":");return n.startsWith(" ")&&(n=n.substring(1)),t==="event"?this.event=n:t==="data"&&this.data.push(n),null}};function Od(r,e){let t=r.indexOf(e);return t!==-1?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}});var ci=u(wr=>{"use strict";o();Object.defineProperty(wr,"__esModule",{value:!0});wr.defaultParseResponse=Rd;wr.addRequestID=Cc;var qd=oi(),ai=vt();async function Rd(r,e){let{response:t,requestLogID:s,retryOfRequestLogID:n,startTime:i}=e,a=await(async()=>{if(e.options.stream)return(0,ai.loggerFor)(r).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,r):qd.Stream.fromSSEResponse(t,e.controller,r);if(t.status===204)return null;if(e.options.__binaryResponse)return t;let l=t.headers.get("content-type")?.split(";")[0]?.trim();if(l?.includes("application/json")||l?.endsWith("+json")){let f=await t.json();return Cc(f,t)}return await t.text()})();return(0,ai.loggerFor)(r).debug(`[${s}] response parsed`,(0,ai.formatRequestDetails)({retryOfRequestLogID:n,url:t.url,status:t.status,body:a,durationMs:Date.now()-i})),a}function Cc(r,e){return!r||typeof r!="object"||Array.isArray(r)?r:Object.defineProperty(r,"_request_id",{value:e.headers.get("x-request-id"),enumerable:!1})}});var Sr=u(Ar=>{"use strict";o();var St;Object.defineProperty(Ar,"__esModule",{value:!0});Ar.APIPromise=void 0;var li=A(),Fc=ci(),ui=class r extends Promise{constructor(e,t,s=Fc.defaultParseResponse){super(n=>{n(null)}),this.responsePromise=t,this.parseResponse=s,St.set(this,void 0),li.__classPrivateFieldSet(this,St,e,"f")}_thenUnwrap(e){return new r(li.__classPrivateFieldGet(this,St,"f"),this.responsePromise,async(t,s)=>(0,Fc.addRequestID)(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(li.__classPrivateFieldGet(this,St,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}};Ar.APIPromise=ui;St=new WeakMap});var F=u(de=>{"use strict";o();var Ir;Object.defineProperty(de,"__esModule",{value:!0});de.ConversationCursorPage=de.CursorPage=de.Page=de.PagePromise=de.AbstractPage=void 0;var Ec=A(),Cd=me(),Fd=ci(),Ed=Sr(),xc=Ae(),Xe=class{constructor(e,t,s,n){Ir.set(this,void 0),Ec.__classPrivateFieldSet(this,Ir,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return this.getPaginatedItems().length?this.nextPageRequestOptions()!=null:!1}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new Cd.OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await Ec.__classPrivateFieldGet(this,Ir,"f").requestAPIList(this.constructor,e)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(Ir=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}};de.AbstractPage=Xe;var di=class extends Ed.APIPromise{constructor(e,t,s){super(e,t,async(n,i)=>new s(n,i.response,await(0,Fd.defaultParseResponse)(n,i),i.options))}async*[Symbol.asyncIterator](){let e=await this;for await(let t of e)yield t}};de.PagePromise=di;var hi=class extends Xe{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}};de.Page=hi;var fi=class extends Xe{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...(0,xc.maybeObj)(this.options.query),after:t}}:null}};de.CursorPage=fi;var pi=class extends Xe{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return this.has_more===!1?!1:super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...(0,xc.maybeObj)(this.options.query),after:e}}:null}};de.ConversationCursorPage=pi});var ye=u(H=>{"use strict";o();Object.defineProperty(H,"__esModule",{value:!0});H.createForm=H.multipartFormRequestOptions=H.maybeMultipartFormRequestOptions=H.isAsyncIterable=H.checkFileSupport=void 0;H.makeFile=_i;H.getName=Or;var xd=pt(),Md=()=>{if(typeof File>"u"){let{process:r}=globalThis,e=typeof r?.versions?.node=="string"&&parseInt(r.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(e?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};H.checkFileSupport=Md;function _i(r,e,t){return(0,H.checkFileSupport)(),new File(r,e??"unknown_file",t)}function Or(r){return(typeof r=="object"&&r!==null&&("name"in r&&r.name&&String(r.name)||"url"in r&&r.url&&String(r.url)||"filename"in r&&r.filename&&String(r.filename)||"path"in r&&r.path&&String(r.path))||"").split(/[\\/]/).pop()||void 0}var Td=r=>r!=null&&typeof r=="object"&&typeof r[Symbol.asyncIterator]=="function";H.isAsyncIterable=Td;var jd=async(r,e)=>mi(r.body)?{...r,body:await(0,H.createForm)(r.body,e)}:r;H.maybeMultipartFormRequestOptions=jd;var kd=async(r,e)=>({...r,body:await(0,H.createForm)(r.body,e)});H.multipartFormRequestOptions=kd;var Mc=new WeakMap;function $d(r){let e=typeof r=="function"?r:r.fetch,t=Mc.get(e);if(t)return t;let s=(async()=>{try{let n="Response"in e?e.Response:(await e("data:,")).constructor,i=new FormData;return i.toString()!==await new n(i).text()}catch{return!0}})();return Mc.set(e,s),s}var Nd=async(r,e)=>{if(!await $d(e))throw new TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let t=new FormData;return await Promise.all(Object.entries(r||{}).map(([s,n])=>gi(t,s,n))),t};H.createForm=Nd;var Tc=r=>r instanceof Blob&&"name"in r,Gd=r=>typeof r=="object"&&r!==null&&(r instanceof Response||(0,H.isAsyncIterable)(r)||Tc(r)),mi=r=>{if(Gd(r))return!0;if(Array.isArray(r))return r.some(mi);if(r&&typeof r=="object"){for(let e in r)if(mi(r[e]))return!0}return!1},gi=async(r,e,t)=>{if(t!==void 0){if(t==null)throw new TypeError(`Received null for "${e}"; to pass null in FormData, you must use the string 'null'`);if(typeof t=="string"||typeof t=="number"||typeof t=="boolean")r.append(e,String(t));else if(t instanceof Response)r.append(e,_i([await t.blob()],Or(t)));else if((0,H.isAsyncIterable)(t))r.append(e,_i([await new Response((0,xd.ReadableStreamFrom)(t)).blob()],Or(t)));else if(Tc(t))r.append(e,t,Or(t));else if(Array.isArray(t))await Promise.all(t.map(s=>gi(r,e+"[]",s)));else if(typeof t=="object")await Promise.all(Object.entries(t).map(([s,n])=>gi(r,`${e}[${s}]`,n)));else throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${t} instead`)}}});var kc=u(yi=>{"use strict";o();Object.defineProperty(yi,"__esModule",{value:!0});yi.toFile=Hd;var It=ye(),Bd=ye(),jc=r=>r!=null&&typeof r=="object"&&typeof r.size=="number"&&typeof r.type=="string"&&typeof r.text=="function"&&typeof r.slice=="function"&&typeof r.arrayBuffer=="function",Ld=r=>r!=null&&typeof r=="object"&&typeof r.name=="string"&&typeof r.lastModified=="number"&&jc(r),Ud=r=>r!=null&&typeof r=="object"&&typeof r.url=="string"&&typeof r.blob=="function";async function Hd(r,e,t){if((0,Bd.checkFileSupport)(),r=await r,Ld(r))return r instanceof File?r:(0,It.makeFile)([await r.arrayBuffer()],r.name);if(Ud(r)){let n=await r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()),(0,It.makeFile)(await bi(n),e,t)}let s=await bi(r);if(e||(e=(0,It.getName)(r)),!t?.type){let n=s.find(i=>typeof i=="object"&&"type"in i&&i.type);typeof n=="string"&&(t={...t,type:n})}return(0,It.makeFile)(s,e,t)}async function bi(r){let e=[];if(typeof r=="string"||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(jc(r))e.push(r instanceof Blob?r:await r.arrayBuffer());else if((0,It.isAsyncIterable)(r))for await(let t of r)e.push(...await bi(t));else{let t=r?.constructor?.name;throw new Error(`Unexpected data type: ${typeof r}${t?`; constructor: ${t}`:""}${Dd(r)}`)}return e}function Dd(r){return typeof r!="object"||r===null?"":`; props: [${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}});var Pi=u(qr=>{"use strict";o();Object.defineProperty(qr,"__esModule",{value:!0});qr.toFile=void 0;var Wd=kc();Object.defineProperty(qr,"toFile",{enumerable:!0,get:function(){return Wd.toFile}})});var _=u(Rr=>{"use strict";o();Object.defineProperty(Rr,"__esModule",{value:!0});Rr.APIResource=void 0;var vi=class{constructor(e){this._client=e}};Rr.APIResource=vi});var C=u(Oe=>{"use strict";o();Object.defineProperty(Oe,"__esModule",{value:!0});Oe.path=Oe.createPathTagFunction=void 0;Oe.encodeURIPath=wi;var Jd=me();function wi(r){return r.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}var $c=Object.freeze(Object.create(null)),Vd=(r=wi)=>function(t,...s){if(t.length===1)return t[0];let n=!1,i=[],a=t.reduce((g,f,b)=>{/[?#]/.test(f)&&(n=!0);let d=s[b],S=(n?encodeURIComponent:r)(""+d);return b!==s.length&&(d==null||typeof d=="object"&&d.toString===Object.getPrototypeOf(Object.getPrototypeOf(d.hasOwnProperty??$c)??$c)?.toString)&&(S=d+"",i.push({start:g.length+f.length,length:S.length,error:`Value of type ${Object.prototype.toString.call(d).slice(8,-1)} is not a valid path parameter`})),g+f+(b===s.length?"":S)},""),c=a.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi,h;for(;(h=l.exec(c))!==null;)i.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(i.sort((g,f)=>g.start-f.start),i.length>0){let g=0,f=i.reduce((b,d)=>{let S=" ".repeat(d.start-g),y="^".repeat(d.length);return g=d.start+d.length,b+S+y},"");throw new Jd.OpenAIError(`Path parameters result in path with invalid segments:
${i.map(b=>b.error).join(`
`)}
${a}
${f}`)}return a};Oe.createPathTagFunction=Vd;Oe.path=(0,Oe.createPathTagFunction)(wi)});var Fr=u(Cr=>{"use strict";o();Object.defineProperty(Cr,"__esModule",{value:!0});Cr.Messages=void 0;var Xd=_(),Kd=F(),zd=C(),Ai=class extends Xd.APIResource{list(e,t={},s){return this._client.getAPIList((0,zd.path)`/chat/completions/${e}/messages`,Kd.CursorPage,{query:t,...s})}};Cr.Messages=Ai});var fe=u(Si=>{"use strict";o();Object.defineProperty(Si,"__esModule",{value:!0});var Qd=A();Qd.__exportStar(me(),Si)});var qt=u(ee=>{"use strict";o();Object.defineProperty(ee,"__esModule",{value:!0});ee.isChatCompletionFunctionTool=Er;ee.makeParseableResponseFormat=Yd;ee.makeParseableTextFormat=Zd;ee.isAutoParsableResponseFormat=Nc;ee.makeParseableTool=eh;ee.isAutoParsableTool=xr;ee.maybeParseChatCompletion=th;ee.parseChatCompletion=Gc;ee.shouldParseToolCall=nh;ee.hasAutoParseableInput=Bc;ee.assertToolCallsAreChatCompletionFunctionToolCalls=Ii;ee.validateInputTools=ih;var Ot=fe();function Er(r){return r!==void 0&&"function"in r&&r.function!==void 0}function Yd(r,e){let t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Zd(r,e){let t={...r};return Object.defineProperties(t,{$brand:{value:"auto-parseable-response-format",enumerable:!1},$parseRaw:{value:e,enumerable:!1}}),t}function Nc(r){return r?.$brand==="auto-parseable-response-format"}function eh(r,{parser:e,callback:t}){let s={...r};return Object.defineProperties(s,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),s}function xr(r){return r?.$brand==="auto-parseable-tool"}function th(r,e){return!e||!Bc(e)?{...r,choices:r.choices.map(t=>(Ii(t.message.tool_calls),{...t,message:{...t.message,parsed:null,...t.message.tool_calls?{tool_calls:t.message.tool_calls}:void 0}}))}:Gc(r,e)}function Gc(r,e){let t=r.choices.map(s=>{if(s.finish_reason==="length")throw new Ot.LengthFinishReasonError;if(s.finish_reason==="content_filter")throw new Ot.ContentFilterFinishReasonError;return Ii(s.message.tool_calls),{...s,message:{...s.message,...s.message.tool_calls?{tool_calls:s.message.tool_calls?.map(n=>sh(e,n))??void 0}:void 0,parsed:s.message.content&&!s.message.refusal?rh(e,s.message.content):null}}});return{...r,choices:t}}function rh(r,e){return r.response_format?.type!=="json_schema"?null:r.response_format?.type==="json_schema"?"$parseRaw"in r.response_format?r.response_format.$parseRaw(e):JSON.parse(e):null}function sh(r,e){let t=r.tools?.find(s=>Er(s)&&s.function?.name===e.function.name);return{...e,function:{...e.function,parsed_arguments:xr(t)?t.$parseRaw(e.function.arguments):t?.function.strict?JSON.parse(e.function.arguments):null}}}function nh(r,e){if(!r||!("tools"in r)||!r.tools)return!1;let t=r.tools?.find(s=>Er(s)&&s.function?.name===e.function.name);return Er(t)&&(xr(t)||t?.function.strict||!1)}function Bc(r){return Nc(r.response_format)?!0:r.tools?.some(e=>xr(e)||e.type==="function"&&e.function.strict===!0)??!1}function Ii(r){for(let e of r||[])if(e.type!=="function")throw new Ot.OpenAIError(`Currently only \`function\` tool calls are supported; Received \`${e.type}\``)}function ih(r){for(let e of r??[]){if(e.type!=="function")throw new Ot.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Ot.OpenAIError(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}});var Oi=u(je=>{"use strict";o();Object.defineProperty(je,"__esModule",{value:!0});je.isToolMessage=je.isAssistantMessage=void 0;je.isPresent=ch;var oh=r=>r?.role==="assistant";je.isAssistantMessage=oh;var ah=r=>r?.role==="tool";je.isToolMessage=ah;function ch(r){return r!=null}});var Gr=u(Nr=>{"use strict";o();var qi,Mr,Tr,Ct,Ft,jr,Et,Se,xt,kr,$r,Ke,Lc;Object.defineProperty(Nr,"__esModule",{value:!0});Nr.EventStream=void 0;var q=A(),Rt=fe(),Ri=class{constructor(){qi.add(this),this.controller=new AbortController,Mr.set(this,void 0),Tr.set(this,()=>{}),Ct.set(this,()=>{}),Ft.set(this,void 0),jr.set(this,()=>{}),Et.set(this,()=>{}),Se.set(this,{}),xt.set(this,!1),kr.set(this,!1),$r.set(this,!1),Ke.set(this,!1),q.__classPrivateFieldSet(this,Mr,new Promise((e,t)=>{q.__classPrivateFieldSet(this,Tr,e,"f"),q.__classPrivateFieldSet(this,Ct,t,"f")}),"f"),q.__classPrivateFieldSet(this,Ft,new Promise((e,t)=>{q.__classPrivateFieldSet(this,jr,e,"f"),q.__classPrivateFieldSet(this,Et,t,"f")}),"f"),q.__classPrivateFieldGet(this,Mr,"f").catch(()=>{}),q.__classPrivateFieldGet(this,Ft,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},q.__classPrivateFieldGet(this,qi,"m",Lc).bind(this))},0)}_connected(){this.ended||(q.__classPrivateFieldGet(this,Tr,"f").call(this),this._emit("connect"))}get ended(){return q.__classPrivateFieldGet(this,xt,"f")}get errored(){return q.__classPrivateFieldGet(this,kr,"f")}get aborted(){return q.__classPrivateFieldGet(this,$r,"f")}abort(){this.controller.abort()}on(e,t){return(q.__classPrivateFieldGet(this,Se,"f")[e]||(q.__classPrivateFieldGet(this,Se,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=q.__classPrivateFieldGet(this,Se,"f")[e];if(!s)return this;let n=s.findIndex(i=>i.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(q.__classPrivateFieldGet(this,Se,"f")[e]||(q.__classPrivateFieldGet(this,Se,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{q.__classPrivateFieldSet(this,Ke,!0,"f"),e!=="error"&&this.once("error",s),this.once(e,t)})}async done(){q.__classPrivateFieldSet(this,Ke,!0,"f"),await q.__classPrivateFieldGet(this,Ft,"f")}_emit(e,...t){if(q.__classPrivateFieldGet(this,xt,"f"))return;e==="end"&&(q.__classPrivateFieldSet(this,xt,!0,"f"),q.__classPrivateFieldGet(this,jr,"f").call(this));let s=q.__classPrivateFieldGet(this,Se,"f")[e];if(s&&(q.__classPrivateFieldGet(this,Se,"f")[e]=s.filter(n=>!n.once),s.forEach(({listener:n})=>n(...t))),e==="abort"){let n=t[0];!q.__classPrivateFieldGet(this,Ke,"f")&&!s?.length&&Promise.reject(n),q.__classPrivateFieldGet(this,Ct,"f").call(this,n),q.__classPrivateFieldGet(this,Et,"f").call(this,n),this._emit("end");return}if(e==="error"){let n=t[0];!q.__classPrivateFieldGet(this,Ke,"f")&&!s?.length&&Promise.reject(n),q.__classPrivateFieldGet(this,Ct,"f").call(this,n),q.__classPrivateFieldGet(this,Et,"f").call(this,n),this._emit("end")}}_emitFinal(){}};Nr.EventStream=Ri;Mr=new WeakMap,Tr=new WeakMap,Ct=new WeakMap,Ft=new WeakMap,jr=new WeakMap,Et=new WeakMap,Se=new WeakMap,xt=new WeakMap,kr=new WeakMap,$r=new WeakMap,Ke=new WeakMap,qi=new WeakSet,Lc=function(e){if(q.__classPrivateFieldSet(this,kr,!0,"f"),e instanceof Error&&e.name==="AbortError"&&(e=new Rt.APIUserAbortError),e instanceof Rt.APIUserAbortError)return q.__classPrivateFieldSet(this,$r,!0,"f"),this._emit("abort",e);if(e instanceof Rt.OpenAIError)return this._emit("error",e);if(e instanceof Error){let t=new Rt.OpenAIError(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Rt.OpenAIError(String(e)))}});var Fi=u(Mt=>{"use strict";o();Object.defineProperty(Mt,"__esModule",{value:!0});Mt.ParsingToolFunction=void 0;Mt.isRunnableFunctionWithParse=lh;function lh(r){return typeof r.parse=="function"}var Ci=class{constructor(e){this.type="function",this.function=e}};Mt.ParsingToolFunction=Ci});var ki=u(Lr=>{"use strict";o();var Z,Ei,Br,xi,Mi,Ti,Hc,Dc;Object.defineProperty(Lr,"__esModule",{value:!0});Lr.AbstractChatCompletionRunner=void 0;var le=A(),Tt=fe(),Uc=qt(),jt=Oi(),uh=Gr(),dh=Fi(),hh=10,ji=class extends uh.EventStream{constructor(){super(...arguments),Z.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),(0,jt.isToolMessage)(e)&&e.content)this._emit("functionToolCallResult",e.content);else if((0,jt.isAssistantMessage)(e)&&e.tool_calls)for(let s of e.tool_calls)s.type==="function"&&this._emit("functionToolCall",s.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Tt.OpenAIError("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),le.__classPrivateFieldGet(this,Z,"m",Ei).call(this)}async finalMessage(){return await this.done(),le.__classPrivateFieldGet(this,Z,"m",Br).call(this)}async finalFunctionToolCall(){return await this.done(),le.__classPrivateFieldGet(this,Z,"m",xi).call(this)}async finalFunctionToolCallResult(){return await this.done(),le.__classPrivateFieldGet(this,Z,"m",Mi).call(this)}async totalUsage(){return await this.done(),le.__classPrivateFieldGet(this,Z,"m",Ti).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=le.__classPrivateFieldGet(this,Z,"m",Br).call(this);t&&this._emit("finalMessage",t);let s=le.__classPrivateFieldGet(this,Z,"m",Ei).call(this);s&&this._emit("finalContent",s);let n=le.__classPrivateFieldGet(this,Z,"m",xi).call(this);n&&this._emit("finalFunctionToolCall",n);let i=le.__classPrivateFieldGet(this,Z,"m",Mi).call(this);i!=null&&this._emit("finalFunctionToolCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",le.__classPrivateFieldGet(this,Z,"m",Ti).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),le.__classPrivateFieldGet(this,Z,"m",Hc).call(this,t);let i=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion((0,Uc.parseChatCompletion)(i,t))}async _runChatCompletion(e,t,s){for(let n of t.messages)this._addMessage(n,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:i="auto",stream:a,...c}=t,l=typeof i!="string"&&i.type==="function"&&i?.function?.name,{maxChatCompletions:h=hh}=s||{},g=t.tools.map(d=>{if((0,Uc.isAutoParsableTool)(d)){if(!d.$callback)throw new Tt.OpenAIError("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:d.$callback,name:d.function.name,description:d.function.description||"",parameters:d.function.parameters,parse:d.$parseRaw,strict:!0}}}return d}),f={};for(let d of g)d.type==="function"&&(f[d.function.name||d.function.function.name]=d.function);let b="tools"in t?g.map(d=>d.type==="function"?{type:"function",function:{name:d.function.name||d.function.function.name,parameters:d.function.parameters,description:d.function.description,strict:d.function.strict}}:d):void 0;for(let d of t.messages)this._addMessage(d,!1);for(let d=0;d<h;++d){let y=(await this._createChatCompletion(e,{...c,tool_choice:i,tools:b,messages:[...this.messages]},s)).choices[0]?.message;if(!y)throw new Tt.OpenAIError("missing message in ChatCompletion response");if(!y.tool_calls?.length)return;for(let N of y.tool_calls){if(N.type!=="function")continue;let E=N.id,{name:m,arguments:J}=N.function,T=f[m];if(T){if(l&&l!==m){let V=`Invalid tool_call: ${JSON.stringify(m)}. ${JSON.stringify(l)} requested. Please try again`;this._addMessage({role:n,tool_call_id:E,content:V});continue}}else{let V=`Invalid tool_call: ${JSON.stringify(m)}. Available options are: ${Object.keys(f).map(X=>JSON.stringify(X)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:E,content:V});continue}let ne;try{ne=(0,dh.isRunnableFunctionWithParse)(T)?await T.parse(J):J}catch(V){let X=V instanceof Error?V.message:String(V);this._addMessage({role:n,tool_call_id:E,content:X});continue}let Y=await T.function(ne,this),k=le.__classPrivateFieldGet(this,Z,"m",Dc).call(this,Y);if(this._addMessage({role:n,tool_call_id:E,content:k}),l)return}}}};Lr.AbstractChatCompletionRunner=ji;Z=new WeakSet,Ei=function(){return le.__classPrivateFieldGet(this,Z,"m",Br).call(this).content??null},Br=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if((0,jt.isAssistantMessage)(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new Tt.OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},xi=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if((0,jt.isAssistantMessage)(t)&&t?.tool_calls?.length)return t.tool_calls.filter(s=>s.type==="function").at(-1)?.function}},Mi=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if((0,jt.isToolMessage)(t)&&t.content!=null&&typeof t.content=="string"&&this.messages.some(s=>s.role==="assistant"&&s.tool_calls?.some(n=>n.type==="function"&&n.id===t.tool_call_id)))return t.content}},Ti=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},Hc=function(e){if(e.n!=null&&e.n>1)throw new Tt.OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},Dc=function(e){return typeof e=="string"?e:e===void 0?"undefined":JSON.stringify(e)}});var Ni=u(Ur=>{"use strict";o();Object.defineProperty(Ur,"__esModule",{value:!0});Ur.ChatCompletionRunner=void 0;var fh=ki(),ph=Oi(),$i=class r extends fh.AbstractChatCompletionRunner{static runTools(e,t,s){let n=new r,i={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}_addMessage(e,t=!0){super._addMessage(e,t),(0,ph.isAssistantMessage)(e)&&e.content&&this._emit("content",e.content)}};Ur.ChatCompletionRunner=$i});var nl=u(qe=>{"use strict";o();Object.defineProperty(qe,"__esModule",{value:!0});qe.MalformedJSON=qe.PartialJSON=qe.partialParse=void 0;var Wc=1,Jc=2,Vc=4,Xc=8,Kc=16,zc=32,Qc=64,Yc=128,Zc=256,el=Yc|Zc,tl=Kc|zc|el|Qc,rl=Wc|Jc|tl,sl=Vc|Xc,_h=rl|sl,K={STR:Wc,NUM:Jc,ARR:Vc,OBJ:Xc,NULL:Kc,BOOL:zc,NAN:Qc,INFINITY:Yc,MINUS_INFINITY:Zc,INF:el,SPECIAL:tl,ATOM:rl,COLLECTION:sl,ALL:_h},Hr=class extends Error{};qe.PartialJSON=Hr;var Dr=class extends Error{};qe.MalformedJSON=Dr;function mh(r,e=K.ALL){if(typeof r!="string")throw new TypeError(`expecting str, got ${typeof r}`);if(!r.trim())throw new Error(`${r} is empty`);return gh(r.trim(),e)}var gh=(r,e)=>{let t=r.length,s=0,n=b=>{throw new Hr(`${b} at position ${s}`)},i=b=>{throw new Dr(`${b} at position ${s}`)},a=()=>(f(),s>=t&&n("Unexpected end of input"),r[s]==='"'?c():r[s]==="{"?l():r[s]==="["?h():r.substring(s,s+4)==="null"||K.NULL&e&&t-s<4&&"null".startsWith(r.substring(s))?(s+=4,null):r.substring(s,s+4)==="true"||K.BOOL&e&&t-s<4&&"true".startsWith(r.substring(s))?(s+=4,!0):r.substring(s,s+5)==="false"||K.BOOL&e&&t-s<5&&"false".startsWith(r.substring(s))?(s+=5,!1):r.substring(s,s+8)==="Infinity"||K.INFINITY&e&&t-s<8&&"Infinity".startsWith(r.substring(s))?(s+=8,1/0):r.substring(s,s+9)==="-Infinity"||K.MINUS_INFINITY&e&&1<t-s&&t-s<9&&"-Infinity".startsWith(r.substring(s))?(s+=9,-1/0):r.substring(s,s+3)==="NaN"||K.NAN&e&&t-s<3&&"NaN".startsWith(r.substring(s))?(s+=3,NaN):g()),c=()=>{let b=s,d=!1;for(s++;s<t&&(r[s]!=='"'||d&&r[s-1]==="\\");)d=r[s]==="\\"?!d:!1,s++;if(r.charAt(s)=='"')try{return JSON.parse(r.substring(b,++s-Number(d)))}catch(S){i(String(S))}else if(K.STR&e)try{return JSON.parse(r.substring(b,s-Number(d))+'"')}catch{return JSON.parse(r.substring(b,r.lastIndexOf("\\"))+'"')}n("Unterminated string literal")},l=()=>{s++,f();let b={};try{for(;r[s]!=="}";){if(f(),s>=t&&K.OBJ&e)return b;let d=c();f(),s++;try{let S=a();Object.defineProperty(b,d,{value:S,writable:!0,enumerable:!0,configurable:!0})}catch(S){if(K.OBJ&e)return b;throw S}f(),r[s]===","&&s++}}catch{if(K.OBJ&e)return b;n("Expected '}' at end of object")}return s++,b},h=()=>{s++;let b=[];try{for(;r[s]!=="]";)b.push(a()),f(),r[s]===","&&s++}catch{if(K.ARR&e)return b;n("Expected ']' at end of array")}return s++,b},g=()=>{if(s===0){r==="-"&&K.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(r)}catch(d){if(K.NUM&e)try{return r[r.length-1]==="."?JSON.parse(r.substring(0,r.lastIndexOf("."))):JSON.parse(r.substring(0,r.lastIndexOf("e")))}catch{}i(String(d))}}let b=s;for(r[s]==="-"&&s++;r[s]&&!",]}".includes(r[s]);)s++;s==t&&!(K.NUM&e)&&n("Unterminated number literal");try{return JSON.parse(r.substring(b,s))}catch{r.substring(b,s)==="-"&&K.NUM&e&&n("Not sure what '-' is");try{return JSON.parse(r.substring(b,r.lastIndexOf("e")))}catch(S){i(String(S))}}},f=()=>{for(;s<t&&` 
\r	`.includes(r[s]);)s++};return a()},bh=r=>mh(r,K.ALL^K.NUM);qe.partialParse=bh});var Bi=u(Gi=>{"use strict";o();Object.defineProperty(Gi,"__esModule",{value:!0});var yh=A();yh.__exportStar(oi(),Gi)});var Kr=u(Xr=>{"use strict";o();var D,Ie,ze,Re,Li,Wr,Ui,Hi,Di,Jr,Wi,il;Object.defineProperty(Xr,"__esModule",{value:!0});Xr.ChatCompletionStream=void 0;var R=A(),ol=nl(),te=fe(),Qe=qt(),al=Bi(),Ph=ki(),Ji=class r extends Ph.AbstractChatCompletionRunner{constructor(e){super(),D.add(this),Ie.set(this,void 0),ze.set(this,void 0),Re.set(this,void 0),R.__classPrivateFieldSet(this,Ie,e,"f"),R.__classPrivateFieldSet(this,ze,[],"f")}get currentChatCompletionSnapshot(){return R.__classPrivateFieldGet(this,Re,"f")}static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new r(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),R.__classPrivateFieldGet(this,D,"m",Li).call(this);let i=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(let a of i)R.__classPrivateFieldGet(this,D,"m",Ui).call(this,a);if(i.controller.signal?.aborted)throw new te.APIUserAbortError;return this._addChatCompletion(R.__classPrivateFieldGet(this,D,"m",Jr).call(this))}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),R.__classPrivateFieldGet(this,D,"m",Li).call(this),this._connected();let n=al.Stream.fromReadableStream(e,this.controller),i;for await(let a of n)i&&i!==a.id&&this._addChatCompletion(R.__classPrivateFieldGet(this,D,"m",Jr).call(this)),R.__classPrivateFieldGet(this,D,"m",Ui).call(this,a),i=a.id;if(n.controller.signal?.aborted)throw new te.APIUserAbortError;return this._addChatCompletion(R.__classPrivateFieldGet(this,D,"m",Jr).call(this))}[(Ie=new WeakMap,ze=new WeakMap,Re=new WeakMap,D=new WeakSet,Li=function(){this.ended||R.__classPrivateFieldSet(this,Re,void 0,"f")},Wr=function(t){let s=R.__classPrivateFieldGet(this,ze,"f")[t.index];return s||(s={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},R.__classPrivateFieldGet(this,ze,"f")[t.index]=s,s)},Ui=function(t){if(this.ended)return;let s=R.__classPrivateFieldGet(this,D,"m",il).call(this,t);this._emit("chunk",t,s);for(let n of t.choices){let i=s.choices[n.index];n.delta.content!=null&&i.message?.role==="assistant"&&i.message?.content&&(this._emit("content",n.delta.content,i.message.content),this._emit("content.delta",{delta:n.delta.content,snapshot:i.message.content,parsed:i.message.parsed})),n.delta.refusal!=null&&i.message?.role==="assistant"&&i.message?.refusal&&this._emit("refusal.delta",{delta:n.delta.refusal,snapshot:i.message.refusal}),n.logprobs?.content!=null&&i.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:n.logprobs?.content,snapshot:i.logprobs?.content??[]}),n.logprobs?.refusal!=null&&i.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:n.logprobs?.refusal,snapshot:i.logprobs?.refusal??[]});let a=R.__classPrivateFieldGet(this,D,"m",Wr).call(this,i);i.finish_reason&&(R.__classPrivateFieldGet(this,D,"m",Di).call(this,i),a.current_tool_call_index!=null&&R.__classPrivateFieldGet(this,D,"m",Hi).call(this,i,a.current_tool_call_index));for(let c of n.delta.tool_calls??[])a.current_tool_call_index!==c.index&&(R.__classPrivateFieldGet(this,D,"m",Di).call(this,i),a.current_tool_call_index!=null&&R.__classPrivateFieldGet(this,D,"m",Hi).call(this,i,a.current_tool_call_index)),a.current_tool_call_index=c.index;for(let c of n.delta.tool_calls??[]){let l=i.message.tool_calls?.[c.index];l?.type&&(l?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:l.function?.name,index:c.index,arguments:l.function.arguments,parsed_arguments:l.function.parsed_arguments,arguments_delta:c.function?.arguments??""}):(l?.type,void 0))}}},Hi=function(t,s){if(R.__classPrivateFieldGet(this,D,"m",Wr).call(this,t).done_tool_calls.has(s))return;let i=t.message.tool_calls?.[s];if(!i)throw new Error("no tool call snapshot");if(!i.type)throw new Error("tool call snapshot missing `type`");if(i.type==="function"){let a=R.__classPrivateFieldGet(this,Ie,"f")?.tools?.find(c=>(0,Qe.isChatCompletionFunctionTool)(c)&&c.function.name===i.function.name);this._emit("tool_calls.function.arguments.done",{name:i.function.name,index:s,arguments:i.function.arguments,parsed_arguments:(0,Qe.isAutoParsableTool)(a)?a.$parseRaw(i.function.arguments):a?.function.strict?JSON.parse(i.function.arguments):null})}else i.type},Di=function(t){let s=R.__classPrivateFieldGet(this,D,"m",Wr).call(this,t);if(t.message.content&&!s.content_done){s.content_done=!0;let n=R.__classPrivateFieldGet(this,D,"m",Wi).call(this);this._emit("content.done",{content:t.message.content,parsed:n?n.$parseRaw(t.message.content):null})}t.message.refusal&&!s.refusal_done&&(s.refusal_done=!0,this._emit("refusal.done",{refusal:t.message.refusal})),t.logprobs?.content&&!s.logprobs_content_done&&(s.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:t.logprobs.content})),t.logprobs?.refusal&&!s.logprobs_refusal_done&&(s.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:t.logprobs.refusal}))},Jr=function(){if(this.ended)throw new te.OpenAIError("stream has ended, this shouldn't happen");let t=R.__classPrivateFieldGet(this,Re,"f");if(!t)throw new te.OpenAIError("request ended without sending any chunks");return R.__classPrivateFieldSet(this,Re,void 0,"f"),R.__classPrivateFieldSet(this,ze,[],"f"),vh(t,R.__classPrivateFieldGet(this,Ie,"f"))},Wi=function(){let t=R.__classPrivateFieldGet(this,Ie,"f")?.response_format;return(0,Qe.isAutoParsableResponseFormat)(t)?t:null},il=function(t){var s,n,i,a;let c=R.__classPrivateFieldGet(this,Re,"f"),{choices:l,...h}=t;c?Object.assign(c,h):c=R.__classPrivateFieldSet(this,Re,{...h,choices:[]},"f");for(let{delta:g,finish_reason:f,index:b,logprobs:d=null,...S}of t.choices){let y=c.choices[b];if(y||(y=c.choices[b]={finish_reason:f,index:b,message:{},logprobs:d,...S}),d)if(!y.logprobs)y.logprobs=Object.assign({},d);else{let{content:Y,refusal:k,...V}=d;Object.assign(y.logprobs,V),Y&&((s=y.logprobs).content??(s.content=[]),y.logprobs.content.push(...Y)),k&&((n=y.logprobs).refusal??(n.refusal=[]),y.logprobs.refusal.push(...k))}if(f&&(y.finish_reason=f,R.__classPrivateFieldGet(this,Ie,"f")&&(0,Qe.hasAutoParseableInput)(R.__classPrivateFieldGet(this,Ie,"f")))){if(f==="length")throw new te.LengthFinishReasonError;if(f==="content_filter")throw new te.ContentFilterFinishReasonError}if(Object.assign(y,S),!g)continue;let{content:N,refusal:E,function_call:m,role:J,tool_calls:T,...ne}=g;if(Object.assign(y.message,ne),E&&(y.message.refusal=(y.message.refusal||"")+E),J&&(y.message.role=J),m&&(y.message.function_call?(m.name&&(y.message.function_call.name=m.name),m.arguments&&((i=y.message.function_call).arguments??(i.arguments=""),y.message.function_call.arguments+=m.arguments)):y.message.function_call=m),N&&(y.message.content=(y.message.content||"")+N,!y.message.refusal&&R.__classPrivateFieldGet(this,D,"m",Wi).call(this)&&(y.message.parsed=(0,ol.partialParse)(y.message.content))),T){y.message.tool_calls||(y.message.tool_calls=[]);for(let{index:Y,id:k,type:V,function:X,...G}of T){let B=(a=y.message.tool_calls)[Y]??(a[Y]={});Object.assign(B,G),k&&(B.id=k),V&&(B.type=V),X&&(B.function??(B.function={name:X.name??"",arguments:""})),X?.name&&(B.function.name=X.name),X?.arguments&&(B.function.arguments+=X.arguments,(0,Qe.shouldParseToolCall)(R.__classPrivateFieldGet(this,Ie,"f"),B)&&(B.function.parsed_arguments=(0,ol.partialParse)(B.function.arguments)))}}}return c},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new al.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}};Xr.ChatCompletionStream=Ji;function vh(r,e){let{id:t,choices:s,created:n,model:i,system_fingerprint:a,...c}=r,l={...c,id:t,choices:s.map(({message:h,finish_reason:g,index:f,logprobs:b,...d})=>{if(!g)throw new te.OpenAIError(`missing finish_reason for choice ${f}`);let{content:S=null,function_call:y,tool_calls:N,...E}=h,m=h.role;if(!m)throw new te.OpenAIError(`missing role for choice ${f}`);if(y){let{arguments:J,name:T}=y;if(J==null)throw new te.OpenAIError(`missing function_call.arguments for choice ${f}`);if(!T)throw new te.OpenAIError(`missing function_call.name for choice ${f}`);return{...d,message:{content:S,function_call:{arguments:J,name:T},role:m,refusal:h.refusal??null},finish_reason:g,index:f,logprobs:b}}return N?{...d,index:f,finish_reason:g,logprobs:b,message:{...E,role:m,content:S,refusal:h.refusal??null,tool_calls:N.map((J,T)=>{let{function:ne,type:Y,id:k,...V}=J,{arguments:X,name:G,...B}=ne||{};if(k==null)throw new te.OpenAIError(`missing choices[${f}].tool_calls[${T}].id
${Vr(r)}`);if(Y==null)throw new te.OpenAIError(`missing choices[${f}].tool_calls[${T}].type
${Vr(r)}`);if(G==null)throw new te.OpenAIError(`missing choices[${f}].tool_calls[${T}].function.name
${Vr(r)}`);if(X==null)throw new te.OpenAIError(`missing choices[${f}].tool_calls[${T}].function.arguments
${Vr(r)}`);return{...V,id:k,type:Y,function:{...B,name:G,arguments:X}}})}}:{...d,message:{...E,content:S,role:m,refusal:h.refusal??null},finish_reason:g,index:f,logprobs:b}}),created:n,model:i,object:"chat.completion",...a?{system_fingerprint:a}:{}};return(0,Qe.maybeParseChatCompletion)(l,e)}function Vr(r){return JSON.stringify(r)}});var Xi=u(zr=>{"use strict";o();Object.defineProperty(zr,"__esModule",{value:!0});zr.ChatCompletionStreamingRunner=void 0;var wh=Kr(),Vi=class r extends wh.ChatCompletionStream{static fromReadableStream(e){let t=new r(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new r(t),i={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,i)),n}};zr.ChatCompletionStreamingRunner=Vi});var kt=u(he=>{"use strict";o();Object.defineProperty(he,"__esModule",{value:!0});he.ChatCompletionRunner=he.ChatCompletionStream=he.ParsingToolFunction=he.ChatCompletionStreamingRunner=he.Completions=void 0;var Ah=A(),Sh=_(),Ih=Ah.__importStar(Fr()),Oh=Fr(),qh=F(),Ki=C(),Rh=Ni(),Ch=Xi(),Fh=Kr(),cl=qt(),Qr=class extends Sh.APIResource{constructor(){super(...arguments),this.messages=new Ih.Messages(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get((0,Ki.path)`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post((0,Ki.path)`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",qh.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,Ki.path)`/chat/completions/${e}`,t)}parse(e,t){return(0,cl.validateInputTools)(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(s=>(0,cl.parseChatCompletion)(s,e))}runTools(e,t){return e.stream?Ch.ChatCompletionStreamingRunner.runTools(this._client,e,t):Rh.ChatCompletionRunner.runTools(this._client,e,t)}stream(e,t){return Fh.ChatCompletionStream.createChatCompletion(this._client,e,t)}};he.Completions=Qr;var Eh=Xi();Object.defineProperty(he,"ChatCompletionStreamingRunner",{enumerable:!0,get:function(){return Eh.ChatCompletionStreamingRunner}});var xh=Fi();Object.defineProperty(he,"ParsingToolFunction",{enumerable:!0,get:function(){return xh.ParsingToolFunction}});var Mh=Kr();Object.defineProperty(he,"ChatCompletionStream",{enumerable:!0,get:function(){return Mh.ChatCompletionStream}});var Th=Ni();Object.defineProperty(he,"ChatCompletionRunner",{enumerable:!0,get:function(){return Th.ChatCompletionRunner}});Qr.Messages=Oh.Messages});var zi=u(Zr=>{"use strict";o();Object.defineProperty(Zr,"__esModule",{value:!0});Zr.Chat=void 0;var jh=A(),kh=_(),$h=jh.__importStar(kt()),Nh=kt(),Yr=class extends kh.APIResource{constructor(){super(...arguments),this.completions=new $h.Completions(this._client)}};Zr.Chat=Yr;Yr.Completions=Nh.Completions});var ll=u(ke=>{"use strict";o();Object.defineProperty(ke,"__esModule",{value:!0});ke.Messages=ke.Completions=void 0;var Gh=A(),Bh=kt();Object.defineProperty(ke,"Completions",{enumerable:!0,get:function(){return Bh.Completions}});Gh.__exportStar(kt(),ke);var Lh=Fr();Object.defineProperty(ke,"Messages",{enumerable:!0,get:function(){return Lh.Messages}})});var ul=u(Ye=>{"use strict";o();Object.defineProperty(Ye,"__esModule",{value:!0});Ye.Completions=Ye.Chat=void 0;var Uh=zi();Object.defineProperty(Ye,"Chat",{enumerable:!0,get:function(){return Uh.Chat}});var Hh=ll();Object.defineProperty(Ye,"Completions",{enumerable:!0,get:function(){return Hh.Completions}})});var hl=u(dl=>{"use strict";o();Object.defineProperty(dl,"__esModule",{value:!0})});var x=u(Ze=>{"use strict";o();Object.defineProperty(Ze,"__esModule",{value:!0});Ze.isEmptyHeaders=Ze.buildHeaders=void 0;var fl=Ae(),pl=Symbol("brand.privateNullableHeaders");function*_l(r){if(!r)return;if(pl in r){let{values:s,nulls:n}=r;yield*s.entries();for(let i of n)yield[i,null];return}let e=!1,t;r instanceof Headers?t=r.entries():(0,fl.isReadonlyArray)(r)?t=r:(e=!0,t=Object.entries(r??{}));for(let s of t){let n=s[0];if(typeof n!="string")throw new TypeError("expected header name to be a string");let i=(0,fl.isReadonlyArray)(s[1])?s[1]:[s[1]],a=!1;for(let c of i)c!==void 0&&(e&&!a&&(a=!0,yield[n,null]),yield[n,c])}}var Dh=r=>{let e=new Headers,t=new Set;for(let s of r){let n=new Set;for(let[i,a]of _l(s)){let c=i.toLowerCase();n.has(c)||(e.delete(i),n.add(c)),a===null?(e.delete(i),t.add(c)):(e.append(i,a),t.delete(c))}}return{[pl]:!0,values:e,nulls:t}};Ze.buildHeaders=Dh;var Wh=r=>{for(let e of _l(r))return!1;return!0};Ze.isEmptyHeaders=Wh});var Yi=u(es=>{"use strict";o();Object.defineProperty(es,"__esModule",{value:!0});es.Speech=void 0;var Jh=_(),Vh=x(),Qi=class extends Jh.APIResource{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:(0,Vh.buildHeaders)([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}};es.Speech=Qi});var eo=u(ts=>{"use strict";o();Object.defineProperty(ts,"__esModule",{value:!0});ts.Transcriptions=void 0;var Xh=_(),Kh=ye(),Zi=class extends Xh.APIResource{create(e,t){return this._client.post("/audio/transcriptions",(0,Kh.multipartFormRequestOptions)({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}};ts.Transcriptions=Zi});var ro=u(rs=>{"use strict";o();Object.defineProperty(rs,"__esModule",{value:!0});rs.Translations=void 0;var zh=_(),Qh=ye(),to=class extends zh.APIResource{create(e,t){return this._client.post("/audio/translations",(0,Qh.multipartFormRequestOptions)({body:e,...t,__metadata:{model:e.model}},this._client))}};rs.Translations=to});var no=u(ss=>{"use strict";o();Object.defineProperty(ss,"__esModule",{value:!0});ss.Audio=void 0;var so=A(),Yh=_(),Zh=so.__importStar(Yi()),ef=Yi(),tf=so.__importStar(eo()),rf=eo(),sf=so.__importStar(ro()),nf=ro(),et=class extends Yh.APIResource{constructor(){super(...arguments),this.transcriptions=new tf.Transcriptions(this._client),this.translations=new sf.Translations(this._client),this.speech=new Zh.Speech(this._client)}};ss.Audio=et;et.Transcriptions=rf.Transcriptions;et.Translations=nf.Translations;et.Speech=ef.Speech});var oo=u(ns=>{"use strict";o();Object.defineProperty(ns,"__esModule",{value:!0});ns.Batches=void 0;var of=_(),af=F(),ml=C(),io=class extends of.APIResource{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get((0,ml.path)`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",af.CursorPage,{query:e,...t})}cancel(e,t){return this._client.post((0,ml.path)`/batches/${e}/cancel`,t)}};ns.Batches=io});var lo=u(is=>{"use strict";o();Object.defineProperty(is,"__esModule",{value:!0});is.Assistants=void 0;var cf=_(),lf=F(),$t=x(),ao=C(),co=class extends cf.APIResource{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:(0,$t.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get((0,ao.path)`/assistants/${e}`,{...t,headers:(0,$t.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post((0,ao.path)`/assistants/${e}`,{body:t,...s,headers:(0,$t.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",lf.CursorPage,{query:e,...t,headers:(0,$t.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete((0,ao.path)`/assistants/${e}`,{...t,headers:(0,$t.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};is.Assistants=co});var ho=u(os=>{"use strict";o();Object.defineProperty(os,"__esModule",{value:!0});os.Sessions=void 0;var uf=_(),df=x(),uo=class extends uf.APIResource{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:(0,df.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};os.Sessions=uo});var po=u(as=>{"use strict";o();Object.defineProperty(as,"__esModule",{value:!0});as.TranscriptionSessions=void 0;var hf=_(),ff=x(),fo=class extends hf.APIResource{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:(0,ff.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}};as.TranscriptionSessions=fo});var _o=u(cs=>{"use strict";o();Object.defineProperty(cs,"__esModule",{value:!0});cs.Realtime=void 0;var gl=A(),pf=_(),_f=gl.__importStar(ho()),mf=ho(),gf=gl.__importStar(po()),bf=po(),Nt=class extends pf.APIResource{constructor(){super(...arguments),this.sessions=new _f.Sessions(this._client),this.transcriptionSessions=new gf.TranscriptionSessions(this._client)}};cs.Realtime=Nt;Nt.Sessions=mf.Sessions;Nt.TranscriptionSessions=bf.TranscriptionSessions});var go=u(ls=>{"use strict";o();Object.defineProperty(ls,"__esModule",{value:!0});ls.Sessions=void 0;var yf=_(),bl=x(),Pf=C(),mo=class extends yf.APIResource{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:(0,bl.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post((0,Pf.path)`/chatkit/sessions/${e}/cancel`,{...t,headers:(0,bl.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}};ls.Sessions=mo});var Po=u(ds=>{"use strict";o();Object.defineProperty(ds,"__esModule",{value:!0});ds.Threads=void 0;var vf=_(),yl=F(),us=x(),bo=C(),yo=class extends vf.APIResource{retrieve(e,t){return this._client.get((0,bo.path)`/chatkit/threads/${e}`,{...t,headers:(0,us.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",yl.ConversationCursorPage,{query:e,...t,headers:(0,us.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete((0,bo.path)`/chatkit/threads/${e}`,{...t,headers:(0,us.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList((0,bo.path)`/chatkit/threads/${e}/items`,yl.ConversationCursorPage,{query:t,...s,headers:(0,us.buildHeaders)([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}};ds.Threads=yo});var vo=u(hs=>{"use strict";o();Object.defineProperty(hs,"__esModule",{value:!0});hs.ChatKit=void 0;var Pl=A(),wf=_(),Af=Pl.__importStar(go()),Sf=go(),If=Pl.__importStar(Po()),Of=Po(),Gt=class extends wf.APIResource{constructor(){super(...arguments),this.sessions=new Af.Sessions(this._client),this.threads=new If.Threads(this._client)}};hs.ChatKit=Gt;Gt.Sessions=Sf.Sessions;Gt.Threads=Of.Threads});var Ao=u(fs=>{"use strict";o();Object.defineProperty(fs,"__esModule",{value:!0});fs.Messages=void 0;var qf=_(),Rf=F(),Bt=x(),Lt=C(),wo=class extends qf.APIResource{create(e,t,s){return this._client.post((0,Lt.path)`/threads/${e}/messages`,{body:t,...s,headers:(0,Bt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get((0,Lt.path)`/threads/${n}/messages/${e}`,{...s,headers:(0,Bt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...i}=t;return this._client.post((0,Lt.path)`/threads/${n}/messages/${e}`,{body:i,...s,headers:(0,Bt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList((0,Lt.path)`/threads/${e}/messages`,Rf.CursorPage,{query:t,...s,headers:(0,Bt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete((0,Lt.path)`/threads/${n}/messages/${e}`,{...s,headers:(0,Bt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}};fs.Messages=wo});var Io=u(ps=>{"use strict";o();Object.defineProperty(ps,"__esModule",{value:!0});ps.Steps=void 0;var Cf=_(),Ff=F(),vl=x(),wl=C(),So=class extends Cf.APIResource{retrieve(e,t,s){let{thread_id:n,run_id:i,...a}=t;return this._client.get((0,wl.path)`/threads/${n}/runs/${i}/steps/${e}`,{query:a,...s,headers:(0,vl.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...i}=t;return this._client.getAPIList((0,wl.path)`/threads/${n}/runs/${e}/steps`,Ff.CursorPage,{query:i,...s,headers:(0,vl.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}};ps.Steps=So});var Sl=u(Ce=>{"use strict";o();Object.defineProperty(Ce,"__esModule",{value:!0});Ce.toFloat32Array=Ce.fromBase64=Ce.toBase64=void 0;var Al=me(),Ef=gr(),xf=r=>{if(!r)return"";if(typeof globalThis.Buffer<"u")return globalThis.Buffer.from(r).toString("base64");if(typeof r=="string"&&(r=(0,Ef.encodeUTF8)(r)),typeof btoa<"u")return btoa(String.fromCharCode.apply(null,r));throw new Al.OpenAIError("Cannot generate base64 string; Expected `Buffer` or `btoa` to be defined")};Ce.toBase64=xf;var Mf=r=>{if(typeof globalThis.Buffer<"u"){let e=globalThis.Buffer.from(r,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}if(typeof atob<"u"){let e=atob(r),t=new Uint8Array(e.length);for(let s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t}throw new Al.OpenAIError("Cannot decode base64 string; Expected `Buffer` or `atob` to be defined")};Ce.fromBase64=Mf;var Tf=r=>{if(typeof Buffer<"u"){let e=Buffer.from(r,"base64");return Array.from(new Float32Array(e.buffer,e.byteOffset,e.length/Float32Array.BYTES_PER_ELEMENT))}else{let e=atob(r),t=e.length,s=new Uint8Array(t);for(let n=0;n<t;n++)s[n]=e.charCodeAt(n);return Array.from(new Float32Array(s.buffer))}};Ce.toFloat32Array=Tf});var Oo=u(_s=>{"use strict";o();Object.defineProperty(_s,"__esModule",{value:!0});_s.readEnv=void 0;var jf=r=>{if(typeof globalThis.process<"u")return globalThis.process.env?.[r]?.trim()??void 0;if(typeof globalThis.Deno<"u")return globalThis.Deno.env?.get?.(r)?.trim()};_s.readEnv=jf});var Ut=u(Fe=>{"use strict";o();Object.defineProperty(Fe,"__esModule",{value:!0});var tt=A();tt.__exportStar(Ae(),Fe);tt.__exportStar(Sl(),Fe);tt.__exportStar(Oo(),Fe);tt.__exportStar(vt(),Fe);tt.__exportStar(Dn(),Fe);tt.__exportStar(We(),Fe)});var Co=u(vs=>{"use strict";o();var z,Ne,Ro,Pe,ms,pe,Ge,rt,$e,ys,ue,gs,bs,Jt,Ht,Dt,Il,Ol,ql,Rl,Cl,Fl,El;Object.defineProperty(vs,"__esModule",{value:!0});vs.AssistantStream=void 0;var p=A(),xl=Bi(),Wt=fe(),kf=Gr(),qo=Ut(),Ps=class extends kf.EventStream{constructor(){super(...arguments),z.add(this),Ro.set(this,[]),Pe.set(this,{}),ms.set(this,{}),pe.set(this,void 0),Ge.set(this,void 0),rt.set(this,void 0),$e.set(this,void 0),ys.set(this,void 0),ue.set(this,void 0),gs.set(this,void 0),bs.set(this,void 0),Jt.set(this,void 0)}[(Ro=new WeakMap,Pe=new WeakMap,ms=new WeakMap,pe=new WeakMap,Ge=new WeakMap,rt=new WeakMap,$e=new WeakMap,ys=new WeakMap,ue=new WeakMap,gs=new WeakMap,bs=new WeakMap,Jt=new WeakMap,z=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new Ne;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=xl.Stream.fromReadableStream(e,this.controller);for await(let i of n)p.__classPrivateFieldGet(this,z,"m",Ht).call(this,i);if(n.controller.signal?.aborted)throw new Wt.APIUserAbortError;return this._addRun(p.__classPrivateFieldGet(this,z,"m",Dt).call(this))}toReadableStream(){return new xl.Stream(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let i=new Ne;return i._run(()=>i._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}async _createToolAssistantStream(e,t,s,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},c=await e.submitToolOutputs(t,a,{...n,signal:this.controller.signal});this._connected();for await(let l of c)p.__classPrivateFieldGet(this,z,"m",Ht).call(this,l);if(c.controller.signal?.aborted)throw new Wt.APIUserAbortError;return this._addRun(p.__classPrivateFieldGet(this,z,"m",Dt).call(this))}static createThreadAssistantStream(e,t,s){let n=new Ne;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let i=new Ne;return i._run(()=>i._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return p.__classPrivateFieldGet(this,gs,"f")}currentRun(){return p.__classPrivateFieldGet(this,bs,"f")}currentMessageSnapshot(){return p.__classPrivateFieldGet(this,pe,"f")}currentRunStepSnapshot(){return p.__classPrivateFieldGet(this,Jt,"f")}async finalRunSteps(){return await this.done(),Object.values(p.__classPrivateFieldGet(this,Pe,"f"))}async finalMessages(){return await this.done(),Object.values(p.__classPrivateFieldGet(this,ms,"f"))}async finalRun(){if(await this.done(),!p.__classPrivateFieldGet(this,Ge,"f"))throw Error("Final run was not received.");return p.__classPrivateFieldGet(this,Ge,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let i={...t,stream:!0},a=await e.createAndRun(i,{...s,signal:this.controller.signal});this._connected();for await(let c of a)p.__classPrivateFieldGet(this,z,"m",Ht).call(this,c);if(a.controller.signal?.aborted)throw new Wt.APIUserAbortError;return this._addRun(p.__classPrivateFieldGet(this,z,"m",Dt).call(this))}async _createAssistantStream(e,t,s,n){let i=n?.signal;i&&(i.aborted&&this.controller.abort(),i.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},c=await e.create(t,a,{...n,signal:this.controller.signal});this._connected();for await(let l of c)p.__classPrivateFieldGet(this,z,"m",Ht).call(this,l);if(c.controller.signal?.aborted)throw new Wt.APIUserAbortError;return this._addRun(p.__classPrivateFieldGet(this,z,"m",Dt).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let i=e[s];if(i==null){e[s]=n;continue}if(s==="index"||s==="type"){e[s]=n;continue}if(typeof i=="string"&&typeof n=="string")i+=n;else if(typeof i=="number"&&typeof n=="number")i+=n;else if((0,qo.isObj)(i)&&(0,qo.isObj)(n))i=this.accumulateDelta(i,n);else if(Array.isArray(i)&&Array.isArray(n)){if(i.every(a=>typeof a=="string"||typeof a=="number")){i.push(...n);continue}for(let a of n){if(!(0,qo.isObj)(a))throw new Error(`Expected array delta entry to be an object but got: ${a}`);let c=a.index;if(c==null)throw console.error(a),new Error("Expected array delta entry to have an `index` property");if(typeof c!="number")throw new Error(`Expected array delta entry \`index\` property to be a number but got ${c}`);let l=i[c];l==null?i.push(a):i[c]=this.accumulateDelta(l,a)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${i}`);e[s]=i}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}};vs.AssistantStream=Ps;Ne=Ps,Ht=function(e){if(!this.ended)switch(p.__classPrivateFieldSet(this,gs,e,"f"),p.__classPrivateFieldGet(this,z,"m",ql).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":p.__classPrivateFieldGet(this,z,"m",El).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":p.__classPrivateFieldGet(this,z,"m",Ol).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":p.__classPrivateFieldGet(this,z,"m",Il).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier");default:}},Dt=function(){if(this.ended)throw new Wt.OpenAIError("stream has ended, this shouldn't happen");if(!p.__classPrivateFieldGet(this,Ge,"f"))throw Error("Final run has not been received");return p.__classPrivateFieldGet(this,Ge,"f")},Il=function(e){let[t,s]=p.__classPrivateFieldGet(this,z,"m",Cl).call(this,e,p.__classPrivateFieldGet(this,pe,"f"));p.__classPrivateFieldSet(this,pe,t,"f"),p.__classPrivateFieldGet(this,ms,"f")[t.id]=t;for(let n of s){let i=t.content[n.index];i?.type=="text"&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let n of e.data.delta.content){if(n.type=="text"&&n.text){let i=n.text,a=t.content[n.index];if(a&&a.type=="text")this._emit("textDelta",i,a.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(n.index!=p.__classPrivateFieldGet(this,rt,"f")){if(p.__classPrivateFieldGet(this,$e,"f"))switch(p.__classPrivateFieldGet(this,$e,"f").type){case"text":this._emit("textDone",p.__classPrivateFieldGet(this,$e,"f").text,p.__classPrivateFieldGet(this,pe,"f"));break;case"image_file":this._emit("imageFileDone",p.__classPrivateFieldGet(this,$e,"f").image_file,p.__classPrivateFieldGet(this,pe,"f"));break}p.__classPrivateFieldSet(this,rt,n.index,"f")}p.__classPrivateFieldSet(this,$e,t.content[n.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(p.__classPrivateFieldGet(this,rt,"f")!==void 0){let n=e.data.content[p.__classPrivateFieldGet(this,rt,"f")];if(n)switch(n.type){case"image_file":this._emit("imageFileDone",n.image_file,p.__classPrivateFieldGet(this,pe,"f"));break;case"text":this._emit("textDone",n.text,p.__classPrivateFieldGet(this,pe,"f"));break}}p.__classPrivateFieldGet(this,pe,"f")&&this._emit("messageDone",e.data),p.__classPrivateFieldSet(this,pe,void 0,"f")}},Ol=function(e){let t=p.__classPrivateFieldGet(this,z,"m",Rl).call(this,e);switch(p.__classPrivateFieldSet(this,Jt,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&s.step_details.type=="tool_calls"&&s.step_details.tool_calls&&t.step_details.type=="tool_calls")for(let i of s.step_details.tool_calls)i.index==p.__classPrivateFieldGet(this,ys,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(p.__classPrivateFieldGet(this,ue,"f")&&this._emit("toolCallDone",p.__classPrivateFieldGet(this,ue,"f")),p.__classPrivateFieldSet(this,ys,i.index,"f"),p.__classPrivateFieldSet(this,ue,t.step_details.tool_calls[i.index],"f"),p.__classPrivateFieldGet(this,ue,"f")&&this._emit("toolCallCreated",p.__classPrivateFieldGet(this,ue,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":p.__classPrivateFieldSet(this,Jt,void 0,"f"),e.data.step_details.type=="tool_calls"&&p.__classPrivateFieldGet(this,ue,"f")&&(this._emit("toolCallDone",p.__classPrivateFieldGet(this,ue,"f")),p.__classPrivateFieldSet(this,ue,void 0,"f")),this._emit("runStepDone",e.data,t);break;case"thread.run.step.in_progress":break}},ql=function(e){p.__classPrivateFieldGet(this,Ro,"f").push(e),this._emit("event",e)},Rl=function(e){switch(e.event){case"thread.run.step.created":return p.__classPrivateFieldGet(this,Pe,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=p.__classPrivateFieldGet(this,Pe,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=Ne.accumulateDelta(t,s.delta);p.__classPrivateFieldGet(this,Pe,"f")[e.data.id]=n}return p.__classPrivateFieldGet(this,Pe,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":p.__classPrivateFieldGet(this,Pe,"f")[e.data.id]=e.data;break}if(p.__classPrivateFieldGet(this,Pe,"f")[e.data.id])return p.__classPrivateFieldGet(this,Pe,"f")[e.data.id];throw new Error("No snapshot available")},Cl=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let i of n.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=p.__classPrivateFieldGet(this,z,"m",Fl).call(this,i,a)}else t.content[i.index]=i,s.push(i);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},Fl=function(e,t){return Ne.accumulateDelta(t,e)},El=function(e){switch(p.__classPrivateFieldSet(this,bs,e.data,"f"),e.event){case"thread.run.created":break;case"thread.run.queued":break;case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":p.__classPrivateFieldSet(this,Ge,e.data,"f"),p.__classPrivateFieldGet(this,ue,"f")&&(this._emit("toolCallDone",p.__classPrivateFieldGet(this,ue,"f")),p.__classPrivateFieldSet(this,ue,void 0,"f"));break;case"thread.run.cancelling":break}}});var Eo=u(As=>{"use strict";o();Object.defineProperty(As,"__esModule",{value:!0});As.Runs=void 0;var $f=A(),Nf=_(),Gf=$f.__importStar(Io()),Bf=Io(),Lf=F(),Be=x(),Fo=Co(),Uf=We(),st=C(),ws=class extends Nf.APIResource{constructor(){super(...arguments),this.steps=new Gf.Steps(this._client)}create(e,t,s){let{include:n,...i}=t;return this._client.post((0,st.path)`/threads/${e}/runs`,{query:{include:n},body:i,...s,headers:(0,Be.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get((0,st.path)`/threads/${n}/runs/${e}`,{...s,headers:(0,Be.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...i}=t;return this._client.post((0,st.path)`/threads/${n}/runs/${e}`,{body:i,...s,headers:(0,Be.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList((0,st.path)`/threads/${e}/runs`,Lf.CursorPage,{query:t,...s,headers:(0,Be.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post((0,st.path)`/threads/${n}/runs/${e}/cancel`,{...s,headers:(0,Be.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return Fo.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=(0,Be.buildHeaders)([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(i.status){case"queued":case"in_progress":case"cancelling":let c=5e3;if(s?.pollIntervalMs)c=s.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let h=parseInt(l);isNaN(h)||(c=h)}}await(0,Uf.sleep)(c);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return i}}}stream(e,t,s){return Fo.AssistantStream.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...i}=t;return this._client.post((0,st.path)`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:i,...s,headers:(0,Be.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return Fo.AssistantStream.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}};As.Runs=ws;ws.Steps=Bf.Steps});var Mo=u(Ss=>{"use strict";o();Object.defineProperty(Ss,"__esModule",{value:!0});Ss.Threads=void 0;var Ml=A(),Hf=_(),Df=Ml.__importStar(Ao()),Wf=Ao(),Jf=Ml.__importStar(Eo()),Vf=Eo(),Vt=x(),Xf=Co(),xo=C(),Xt=class extends Hf.APIResource{constructor(){super(...arguments),this.runs=new Jf.Runs(this._client),this.messages=new Df.Messages(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:(0,Vt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get((0,xo.path)`/threads/${e}`,{...t,headers:(0,Vt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post((0,xo.path)`/threads/${e}`,{body:t,...s,headers:(0,Vt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete((0,xo.path)`/threads/${e}`,{...t,headers:(0,Vt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:(0,Vt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return Xf.AssistantStream.createThreadAssistantStream(e,this._client.beta.threads,t)}};Ss.Threads=Xt;Xt.Runs=Vf.Runs;Xt.Messages=Wf.Messages});var To=u(Os=>{"use strict";o();Object.defineProperty(Os,"__esModule",{value:!0});Os.Beta=void 0;var Is=A(),Kf=_(),zf=Is.__importStar(lo()),Qf=lo(),Yf=Is.__importStar(_o()),Zf=_o(),ep=Is.__importStar(vo()),tp=vo(),rp=Is.__importStar(Mo()),sp=Mo(),Le=class extends Kf.APIResource{constructor(){super(...arguments),this.realtime=new Yf.Realtime(this._client),this.chatkit=new ep.ChatKit(this._client),this.assistants=new zf.Assistants(this._client),this.threads=new rp.Threads(this._client)}};Os.Beta=Le;Le.Realtime=Zf.Realtime;Le.ChatKit=tp.ChatKit;Le.Assistants=Qf.Assistants;Le.Threads=sp.Threads});var ko=u(qs=>{"use strict";o();Object.defineProperty(qs,"__esModule",{value:!0});qs.Completions=void 0;var np=_(),jo=class extends np.APIResource{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}};qs.Completions=jo});var No=u(Rs=>{"use strict";o();Object.defineProperty(Rs,"__esModule",{value:!0});Rs.Content=void 0;var ip=_(),op=x(),ap=C(),$o=class extends ip.APIResource{retrieve(e,t,s){let{container_id:n}=t;return this._client.get((0,ap.path)`/containers/${n}/files/${e}/content`,{...s,headers:(0,op.buildHeaders)([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}};Rs.Content=$o});var Go=u(Es=>{"use strict";o();Object.defineProperty(Es,"__esModule",{value:!0});Es.Files=void 0;var cp=A(),lp=_(),up=cp.__importStar(No()),dp=No(),hp=F(),fp=x(),pp=ye(),Cs=C(),Fs=class extends lp.APIResource{constructor(){super(...arguments),this.content=new up.Content(this._client)}create(e,t,s){return this._client.post((0,Cs.path)`/containers/${e}/files`,(0,pp.multipartFormRequestOptions)({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get((0,Cs.path)`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList((0,Cs.path)`/containers/${e}/files`,hp.CursorPage,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete((0,Cs.path)`/containers/${n}/files/${e}`,{...s,headers:(0,fp.buildHeaders)([{Accept:"*/*"},s?.headers])})}};Es.Files=Fs;Fs.Content=dp.Content});var Bo=u(Ms=>{"use strict";o();Object.defineProperty(Ms,"__esModule",{value:!0});Ms.Containers=void 0;var _p=A(),mp=_(),gp=_p.__importStar(Go()),bp=Go(),yp=F(),Pp=x(),Tl=C(),xs=class extends mp.APIResource{constructor(){super(...arguments),this.files=new gp.Files(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get((0,Tl.path)`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",yp.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,Tl.path)`/containers/${e}`,{...t,headers:(0,Pp.buildHeaders)([{Accept:"*/*"},t?.headers])})}};Ms.Containers=xs;xs.Files=bp.Files});var Uo=u(js=>{"use strict";o();Object.defineProperty(js,"__esModule",{value:!0});js.Items=void 0;var vp=_(),wp=F(),Ts=C(),Lo=class extends vp.APIResource{create(e,t,s){let{include:n,...i}=t;return this._client.post((0,Ts.path)`/conversations/${e}/items`,{query:{include:n},body:i,...s})}retrieve(e,t,s){let{conversation_id:n,...i}=t;return this._client.get((0,Ts.path)`/conversations/${n}/items/${e}`,{query:i,...s})}list(e,t={},s){return this._client.getAPIList((0,Ts.path)`/conversations/${e}/items`,wp.ConversationCursorPage,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete((0,Ts.path)`/conversations/${n}/items/${e}`,s)}};js.Items=Lo});var Do=u($s=>{"use strict";o();Object.defineProperty($s,"__esModule",{value:!0});$s.Conversations=void 0;var Ap=A(),Sp=_(),Ip=Ap.__importStar(Uo()),Op=Uo(),Ho=C(),ks=class extends Sp.APIResource{constructor(){super(...arguments),this.items=new Ip.Items(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get((0,Ho.path)`/conversations/${e}`,t)}update(e,t,s){return this._client.post((0,Ho.path)`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete((0,Ho.path)`/conversations/${e}`,t)}};$s.Conversations=ks;ks.Items=Op.Items});var Vo=u(Ns=>{"use strict";o();Object.defineProperty(Ns,"__esModule",{value:!0});Ns.Embeddings=void 0;var qp=_(),Wo=Ut(),Jo=class extends qp.APIResource{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&(0,Wo.loggerFor)(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let i=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?i:((0,Wo.loggerFor)(this._client).debug("embeddings/decoding base64 embeddings from base64"),i._thenUnwrap(a=>(a&&a.data&&a.data.forEach(c=>{let l=c.embedding;c.embedding=(0,Wo.toFloat32Array)(l)}),a)))}};Ns.Embeddings=Jo});var Ko=u(Gs=>{"use strict";o();Object.defineProperty(Gs,"__esModule",{value:!0});Gs.OutputItems=void 0;var Rp=_(),Cp=F(),jl=C(),Xo=class extends Rp.APIResource{retrieve(e,t,s){let{eval_id:n,run_id:i}=t;return this._client.get((0,jl.path)`/evals/${n}/runs/${i}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...i}=t;return this._client.getAPIList((0,jl.path)`/evals/${n}/runs/${e}/output_items`,Cp.CursorPage,{query:i,...s})}};Gs.OutputItems=Xo});var zo=u(Ls=>{"use strict";o();Object.defineProperty(Ls,"__esModule",{value:!0});Ls.Runs=void 0;var Fp=A(),Ep=_(),xp=Fp.__importStar(Ko()),Mp=Ko(),Tp=F(),Kt=C(),Bs=class extends Ep.APIResource{constructor(){super(...arguments),this.outputItems=new xp.OutputItems(this._client)}create(e,t,s){return this._client.post((0,Kt.path)`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get((0,Kt.path)`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList((0,Kt.path)`/evals/${e}/runs`,Tp.CursorPage,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete((0,Kt.path)`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post((0,Kt.path)`/evals/${n}/runs/${e}`,s)}};Ls.Runs=Bs;Bs.OutputItems=Mp.OutputItems});var Yo=u(Hs=>{"use strict";o();Object.defineProperty(Hs,"__esModule",{value:!0});Hs.Evals=void 0;var jp=A(),kp=_(),$p=jp.__importStar(zo()),Np=zo(),Gp=F(),Qo=C(),Us=class extends kp.APIResource{constructor(){super(...arguments),this.runs=new $p.Runs(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get((0,Qo.path)`/evals/${e}`,t)}update(e,t,s){return this._client.post((0,Qo.path)`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",Gp.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,Qo.path)`/evals/${e}`,t)}};Hs.Evals=Us;Us.Runs=Np.Runs});var ta=u(Ds=>{"use strict";o();Object.defineProperty(Ds,"__esModule",{value:!0});Ds.Files=void 0;var Bp=_(),Lp=F(),Up=x(),Hp=We(),Dp=fe(),Wp=ye(),Zo=C(),ea=class extends Bp.APIResource{create(e,t){return this._client.post("/files",(0,Wp.multipartFormRequestOptions)({body:e,...t},this._client))}retrieve(e,t){return this._client.get((0,Zo.path)`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",Lp.CursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,Zo.path)`/files/${e}`,t)}content(e,t){return this._client.get((0,Zo.path)`/files/${e}/content`,{...t,headers:(0,Up.buildHeaders)([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=1800*1e3}={}){let n=new Set(["processed","error","deleted"]),i=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await(0,Hp.sleep)(t),a=await this.retrieve(e),Date.now()-i>s)throw new Dp.APIConnectionTimeoutError({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}};Ds.Files=ea});var sa=u(Ws=>{"use strict";o();Object.defineProperty(Ws,"__esModule",{value:!0});Ws.Methods=void 0;var Jp=_(),ra=class extends Jp.APIResource{};Ws.Methods=ra});var ia=u(Js=>{"use strict";o();Object.defineProperty(Js,"__esModule",{value:!0});Js.Graders=void 0;var Vp=_(),na=class extends Vp.APIResource{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}};Js.Graders=na});var oa=u(Xs=>{"use strict";o();Object.defineProperty(Xs,"__esModule",{value:!0});Xs.Alpha=void 0;var Xp=A(),Kp=_(),zp=Xp.__importStar(ia()),Qp=ia(),Vs=class extends Kp.APIResource{constructor(){super(...arguments),this.graders=new zp.Graders(this._client)}};Xs.Alpha=Vs;Vs.Graders=Qp.Graders});var la=u(Ks=>{"use strict";o();Object.defineProperty(Ks,"__esModule",{value:!0});Ks.Permissions=void 0;var Yp=_(),Zp=F(),aa=C(),ca=class extends Yp.APIResource{create(e,t,s){return this._client.getAPIList((0,aa.path)`/fine_tuning/checkpoints/${e}/permissions`,Zp.Page,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get((0,aa.path)`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete((0,aa.path)`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}};Ks.Permissions=ca});var ua=u(Qs=>{"use strict";o();Object.defineProperty(Qs,"__esModule",{value:!0});Qs.Checkpoints=void 0;var e_=A(),t_=_(),r_=e_.__importStar(la()),s_=la(),zs=class extends t_.APIResource{constructor(){super(...arguments),this.permissions=new r_.Permissions(this._client)}};Qs.Checkpoints=zs;zs.Permissions=s_.Permissions});var ha=u(Ys=>{"use strict";o();Object.defineProperty(Ys,"__esModule",{value:!0});Ys.Checkpoints=void 0;var n_=_(),i_=F(),o_=C(),da=class extends n_.APIResource{list(e,t={},s){return this._client.getAPIList((0,o_.path)`/fine_tuning/jobs/${e}/checkpoints`,i_.CursorPage,{query:t,...s})}};Ys.Checkpoints=da});var fa=u(en=>{"use strict";o();Object.defineProperty(en,"__esModule",{value:!0});en.Jobs=void 0;var a_=A(),c_=_(),l_=a_.__importStar(ha()),u_=ha(),kl=F(),zt=C(),Zs=class extends c_.APIResource{constructor(){super(...arguments),this.checkpoints=new l_.Checkpoints(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get((0,zt.path)`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",kl.CursorPage,{query:e,...t})}cancel(e,t){return this._client.post((0,zt.path)`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList((0,zt.path)`/fine_tuning/jobs/${e}/events`,kl.CursorPage,{query:t,...s})}pause(e,t){return this._client.post((0,zt.path)`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post((0,zt.path)`/fine_tuning/jobs/${e}/resume`,t)}};en.Jobs=Zs;Zs.Checkpoints=u_.Checkpoints});var pa=u(rn=>{"use strict";o();Object.defineProperty(rn,"__esModule",{value:!0});rn.FineTuning=void 0;var tn=A(),d_=_(),h_=tn.__importStar(sa()),f_=sa(),p_=tn.__importStar(oa()),__=oa(),m_=tn.__importStar(ua()),g_=ua(),b_=tn.__importStar(fa()),y_=fa(),Ue=class extends d_.APIResource{constructor(){super(...arguments),this.methods=new h_.Methods(this._client),this.jobs=new b_.Jobs(this._client),this.checkpoints=new m_.Checkpoints(this._client),this.alpha=new p_.Alpha(this._client)}};rn.FineTuning=Ue;Ue.Methods=f_.Methods;Ue.Jobs=y_.Jobs;Ue.Checkpoints=g_.Checkpoints;Ue.Alpha=__.Alpha});var ma=u(sn=>{"use strict";o();Object.defineProperty(sn,"__esModule",{value:!0});sn.GraderModels=void 0;var P_=_(),_a=class extends P_.APIResource{};sn.GraderModels=_a});var ga=u(on=>{"use strict";o();Object.defineProperty(on,"__esModule",{value:!0});on.Graders=void 0;var v_=A(),w_=_(),A_=v_.__importStar(ma()),S_=ma(),nn=class extends w_.APIResource{constructor(){super(...arguments),this.graderModels=new A_.GraderModels(this._client)}};on.Graders=nn;nn.GraderModels=S_.GraderModels});var ya=u(an=>{"use strict";o();Object.defineProperty(an,"__esModule",{value:!0});an.Images=void 0;var I_=_(),$l=ye(),ba=class extends I_.APIResource{createVariation(e,t){return this._client.post("/images/variations",(0,$l.multipartFormRequestOptions)({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",(0,$l.multipartFormRequestOptions)({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}};an.Images=ba});var va=u(cn=>{"use strict";o();Object.defineProperty(cn,"__esModule",{value:!0});cn.Models=void 0;var O_=_(),q_=F(),Nl=C(),Pa=class extends O_.APIResource{retrieve(e,t){return this._client.get((0,Nl.path)`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",q_.Page,e)}delete(e,t){return this._client.delete((0,Nl.path)`/models/${e}`,t)}};cn.Models=Pa});var Aa=u(ln=>{"use strict";o();Object.defineProperty(ln,"__esModule",{value:!0});ln.Moderations=void 0;var R_=_(),wa=class extends R_.APIResource{create(e,t){return this._client.post("/moderations",{body:e,...t})}};ln.Moderations=wa});var Ia=u(hn=>{"use strict";o();Object.defineProperty(hn,"__esModule",{value:!0});hn.Calls=void 0;var C_=_(),un=x(),dn=C(),Sa=class extends C_.APIResource{accept(e,t,s){return this._client.post((0,dn.path)`/realtime/calls/${e}/accept`,{body:t,...s,headers:(0,un.buildHeaders)([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post((0,dn.path)`/realtime/calls/${e}/hangup`,{...t,headers:(0,un.buildHeaders)([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post((0,dn.path)`/realtime/calls/${e}/refer`,{body:t,...s,headers:(0,un.buildHeaders)([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post((0,dn.path)`/realtime/calls/${e}/reject`,{body:t,...s,headers:(0,un.buildHeaders)([{Accept:"*/*"},s?.headers])})}};hn.Calls=Sa});var qa=u(fn=>{"use strict";o();Object.defineProperty(fn,"__esModule",{value:!0});fn.ClientSecrets=void 0;var F_=_(),Oa=class extends F_.APIResource{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}};fn.ClientSecrets=Oa});var Ra=u(pn=>{"use strict";o();Object.defineProperty(pn,"__esModule",{value:!0});pn.Realtime=void 0;var Gl=A(),E_=_(),x_=Gl.__importStar(Ia()),M_=Ia(),T_=Gl.__importStar(qa()),j_=qa(),Qt=class extends E_.APIResource{constructor(){super(...arguments),this.clientSecrets=new T_.ClientSecrets(this._client),this.calls=new x_.Calls(this._client)}};pn.Realtime=Qt;Qt.ClientSecrets=j_.ClientSecrets;Qt.Calls=M_.Calls});var Fa=u(ve=>{"use strict";o();Object.defineProperty(ve,"__esModule",{value:!0});ve.maybeParseResponse=$_;ve.parseResponse=Ll;ve.hasAutoParseableInput=Ul;ve.makeParseableResponseTool=G_;ve.isAutoParsableTool=Ca;ve.shouldParseToolCall=L_;ve.validateInputTools=U_;ve.addOutputText=Dl;var Bl=fe(),k_=qt();function $_(r,e){return!e||!Ul(e)?{...r,output_parsed:null,output:r.output.map(t=>t.type==="function_call"?{...t,parsed_arguments:null}:t.type==="message"?{...t,content:t.content.map(s=>({...s,parsed:null}))}:t)}:Ll(r,e)}function Ll(r,e){let t=r.output.map(n=>{if(n.type==="function_call")return{...n,parsed_arguments:B_(e,n)};if(n.type==="message"){let i=n.content.map(a=>a.type==="output_text"?{...a,parsed:N_(e,a.text)}:a);return{...n,content:i}}return n}),s=Object.assign({},r,{output:t});return Object.getOwnPropertyDescriptor(r,"output_text")||Dl(s),Object.defineProperty(s,"output_parsed",{enumerable:!0,get(){for(let n of s.output)if(n.type==="message"){for(let i of n.content)if(i.type==="output_text"&&i.parsed!==null)return i.parsed}return null}}),s}function N_(r,e){return r.text?.format?.type!=="json_schema"?null:"$parseRaw"in r.text?.format?(r.text?.format).$parseRaw(e):JSON.parse(e)}function Ul(r){return!!(0,k_.isAutoParsableResponseFormat)(r.text?.format)}function G_(r,{parser:e,callback:t}){let s={...r};return Object.defineProperties(s,{$brand:{value:"auto-parseable-tool",enumerable:!1},$parseRaw:{value:e,enumerable:!1},$callback:{value:t,enumerable:!1}}),s}function Ca(r){return r?.$brand==="auto-parseable-tool"}function Hl(r,e){return r.find(t=>t.type==="function"&&t.name===e)}function B_(r,e){let t=Hl(r.tools??[],e.name);return{...e,...e,parsed_arguments:Ca(t)?t.$parseRaw(e.arguments):t?.strict?JSON.parse(e.arguments):null}}function L_(r,e){if(!r)return!1;let t=Hl(r.tools??[],e.name);return Ca(t)||t?.strict||!1}function U_(r){for(let e of r??[]){if(e.type!=="function")throw new Bl.OpenAIError(`Currently only \`function\` tool types support auto-parsing; Received \`${e.type}\``);if(e.function.strict!==!0)throw new Bl.OpenAIError(`The \`${e.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}function Dl(r){let e=[];for(let t of r.output)if(t.type==="message")for(let s of t.content)s.type==="output_text"&&e.push(s.text);r.output_text=e.join("")}});var Kl=u(gn=>{"use strict";o();var nt,_n,Ee,mn,Wl,Jl,Vl,Xl;Object.defineProperty(gn,"__esModule",{value:!0});gn.ResponseStream=void 0;var re=A(),Q=fe(),H_=Gr(),D_=Fa(),Ea=class r extends H_.EventStream{constructor(e){super(),nt.add(this),_n.set(this,void 0),Ee.set(this,void 0),mn.set(this,void 0),re.__classPrivateFieldSet(this,_n,e,"f")}static createResponse(e,t,s){let n=new r(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),re.__classPrivateFieldGet(this,nt,"m",Wl).call(this);let i,a=null;"response_id"in t?(i=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):i=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected();for await(let c of i)re.__classPrivateFieldGet(this,nt,"m",Jl).call(this,c,a);if(i.controller.signal?.aborted)throw new Q.APIUserAbortError;return re.__classPrivateFieldGet(this,nt,"m",Vl).call(this)}[(_n=new WeakMap,Ee=new WeakMap,mn=new WeakMap,nt=new WeakSet,Wl=function(){this.ended||re.__classPrivateFieldSet(this,Ee,void 0,"f")},Jl=function(t,s){if(this.ended)return;let n=(a,c)=>{(s==null||c.sequence_number>s)&&this._emit(a,c)},i=re.__classPrivateFieldGet(this,nt,"m",Xl).call(this,t);switch(n("event",t),t.type){case"response.output_text.delta":{let a=i.output[t.output_index];if(!a)throw new Q.OpenAIError(`missing output at index ${t.output_index}`);if(a.type==="message"){let c=a.content[t.content_index];if(!c)throw new Q.OpenAIError(`missing content at index ${t.content_index}`);if(c.type!=="output_text")throw new Q.OpenAIError(`expected content to be 'output_text', got ${c.type}`);n("response.output_text.delta",{...t,snapshot:c.text})}break}case"response.function_call_arguments.delta":{let a=i.output[t.output_index];if(!a)throw new Q.OpenAIError(`missing output at index ${t.output_index}`);a.type==="function_call"&&n("response.function_call_arguments.delta",{...t,snapshot:a.arguments});break}default:n(t.type,t);break}},Vl=function(){if(this.ended)throw new Q.OpenAIError("stream has ended, this shouldn't happen");let t=re.__classPrivateFieldGet(this,Ee,"f");if(!t)throw new Q.OpenAIError("request ended without sending any events");re.__classPrivateFieldSet(this,Ee,void 0,"f");let s=W_(t,re.__classPrivateFieldGet(this,_n,"f"));return re.__classPrivateFieldSet(this,mn,s,"f"),s},Xl=function(t){let s=re.__classPrivateFieldGet(this,Ee,"f");if(!s){if(t.type!=="response.created")throw new Q.OpenAIError(`When snapshot hasn't been set yet, expected 'response.created' event, got ${t.type}`);return s=re.__classPrivateFieldSet(this,Ee,t.response,"f"),s}switch(t.type){case"response.output_item.added":{s.output.push(t.item);break}case"response.content_part.added":{let n=s.output[t.output_index];if(!n)throw new Q.OpenAIError(`missing output at index ${t.output_index}`);let i=n.type,a=t.part;i==="message"&&a.type!=="reasoning_text"?n.content.push(a):i==="reasoning"&&a.type==="reasoning_text"&&(n.content||(n.content=[]),n.content.push(a));break}case"response.output_text.delta":{let n=s.output[t.output_index];if(!n)throw new Q.OpenAIError(`missing output at index ${t.output_index}`);if(n.type==="message"){let i=n.content[t.content_index];if(!i)throw new Q.OpenAIError(`missing content at index ${t.content_index}`);if(i.type!=="output_text")throw new Q.OpenAIError(`expected content to be 'output_text', got ${i.type}`);i.text+=t.delta}break}case"response.function_call_arguments.delta":{let n=s.output[t.output_index];if(!n)throw new Q.OpenAIError(`missing output at index ${t.output_index}`);n.type==="function_call"&&(n.arguments+=t.delta);break}case"response.reasoning_text.delta":{let n=s.output[t.output_index];if(!n)throw new Q.OpenAIError(`missing output at index ${t.output_index}`);if(n.type==="reasoning"){let i=n.content?.[t.content_index];if(!i)throw new Q.OpenAIError(`missing content at index ${t.content_index}`);if(i.type!=="reasoning_text")throw new Q.OpenAIError(`expected content to be 'reasoning_text', got ${i.type}`);i.text+=t.delta}break}case"response.completed":{re.__classPrivateFieldSet(this,Ee,t.response,"f");break}}return s},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",n=>{let i=t.shift();i?i.resolve(n):e.push(n)}),this.on("end",()=>{s=!0;for(let n of t)n.resolve(void 0);t.length=0}),this.on("abort",n=>{s=!0;for(let i of t)i.reject(n);t.length=0}),this.on("error",n=>{s=!0;for(let i of t)i.reject(n);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((i,a)=>t.push({resolve:i,reject:a})).then(i=>i?{value:i,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=re.__classPrivateFieldGet(this,mn,"f");if(!e)throw new Q.OpenAIError("stream ended without producing a ChatCompletion");return e}};gn.ResponseStream=Ea;function W_(r,e){return(0,D_.maybeParseResponse)(r,e)}});var Ma=u(bn=>{"use strict";o();Object.defineProperty(bn,"__esModule",{value:!0});bn.InputItems=void 0;var J_=_(),V_=F(),X_=C(),xa=class extends J_.APIResource{list(e,t={},s){return this._client.getAPIList((0,X_.path)`/responses/${e}/input_items`,V_.CursorPage,{query:t,...s})}};bn.InputItems=xa});var ja=u(yn=>{"use strict";o();Object.defineProperty(yn,"__esModule",{value:!0});yn.InputTokens=void 0;var K_=_(),Ta=class extends K_.APIResource{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}};yn.InputTokens=Ta});var Na=u(Pn=>{"use strict";o();Object.defineProperty(Pn,"__esModule",{value:!0});Pn.Responses=void 0;var zl=A(),ka=Fa(),z_=Kl(),Q_=_(),Y_=zl.__importStar(Ma()),Z_=Ma(),em=zl.__importStar(ja()),tm=ja(),rm=x(),$a=C(),Yt=class extends Q_.APIResource{constructor(){super(...arguments),this.inputItems=new Y_.InputItems(this._client),this.inputTokens=new em.InputTokens(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(s=>("object"in s&&s.object==="response"&&(0,ka.addOutputText)(s),s))}retrieve(e,t={},s){return this._client.get((0,$a.path)`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(n=>("object"in n&&n.object==="response"&&(0,ka.addOutputText)(n),n))}delete(e,t){return this._client.delete((0,$a.path)`/responses/${e}`,{...t,headers:(0,rm.buildHeaders)([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(s=>(0,ka.parseResponse)(s,e))}stream(e,t){return z_.ResponseStream.createResponse(this._client,e,t)}cancel(e,t){return this._client.post((0,$a.path)`/responses/${e}/cancel`,t)}};Pn.Responses=Yt;Yt.InputItems=Z_.InputItems;Yt.InputTokens=tm.InputTokens});var Ba=u(vn=>{"use strict";o();Object.defineProperty(vn,"__esModule",{value:!0});vn.Parts=void 0;var sm=_(),nm=ye(),im=C(),Ga=class extends sm.APIResource{create(e,t,s){return this._client.post((0,im.path)`/uploads/${e}/parts`,(0,nm.multipartFormRequestOptions)({body:t,...s},this._client))}};vn.Parts=Ga});var La=u(An=>{"use strict";o();Object.defineProperty(An,"__esModule",{value:!0});An.Uploads=void 0;var om=A(),am=_(),cm=om.__importStar(Ba()),lm=Ba(),Ql=C(),wn=class extends am.APIResource{constructor(){super(...arguments),this.parts=new cm.Parts(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post((0,Ql.path)`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post((0,Ql.path)`/uploads/${e}/complete`,{body:t,...s})}};An.Uploads=wn;wn.Parts=lm.Parts});var Yl=u(Sn=>{"use strict";o();Object.defineProperty(Sn,"__esModule",{value:!0});Sn.allSettledWithThrow=void 0;var um=async r=>{let e=await Promise.allSettled(r),t=e.filter(n=>n.status==="rejected");if(t.length){for(let n of t)console.error(n.reason);throw new Error(`${t.length} promise(s) failed - see the above errors`)}let s=[];for(let n of e)n.status==="fulfilled"&&s.push(n.value);return s};Sn.allSettledWithThrow=um});var Ha=u(On=>{"use strict";o();Object.defineProperty(On,"__esModule",{value:!0});On.FileBatches=void 0;var dm=_(),hm=F(),Zt=x(),fm=We(),pm=Yl(),In=C(),Ua=class extends dm.APIResource{create(e,t,s){return this._client.post((0,In.path)`/vector_stores/${e}/file_batches`,{body:t,...s,headers:(0,Zt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get((0,In.path)`/vector_stores/${n}/file_batches/${e}`,{...s,headers:(0,Zt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post((0,In.path)`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:(0,Zt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...i}=t;return this._client.getAPIList((0,In.path)`/vector_stores/${n}/file_batches/${e}/files`,hm.CursorPage,{query:i,...s,headers:(0,Zt.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=(0,Zt.buildHeaders)([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:i,response:a}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(i.status){case"in_progress":let c=5e3;if(s?.pollIntervalMs)c=s.pollIntervalMs;else{let l=a.headers.get("openai-poll-after-ms");if(l){let h=parseInt(l);isNaN(h)||(c=h)}}await(0,fm.sleep)(c);break;case"failed":case"cancelled":case"completed":return i}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(t==null||t.length==0)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let i=n?.maxConcurrency??5,a=Math.min(i,t.length),c=this._client,l=t.values(),h=[...s];async function g(b){for(let d of b){let S=await c.files.create({file:d,purpose:"assistants"},n);h.push(S.id)}}let f=Array(a).fill(l).map(g);return await(0,pm.allSettledWithThrow)(f),await this.createAndPoll(e,{file_ids:h})}};On.FileBatches=Ua});var Wa=u(qn=>{"use strict";o();Object.defineProperty(qn,"__esModule",{value:!0});qn.Files=void 0;var _m=_(),Zl=F(),He=x(),mm=Ut(),it=C(),Da=class extends _m.APIResource{create(e,t,s){return this._client.post((0,it.path)`/vector_stores/${e}/files`,{body:t,...s,headers:(0,He.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get((0,it.path)`/vector_stores/${n}/files/${e}`,{...s,headers:(0,He.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...i}=t;return this._client.post((0,it.path)`/vector_stores/${n}/files/${e}`,{body:i,...s,headers:(0,He.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList((0,it.path)`/vector_stores/${e}/files`,Zl.CursorPage,{query:t,...s,headers:(0,He.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete((0,it.path)`/vector_stores/${n}/files/${e}`,{...s,headers:(0,He.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=(0,He.buildHeaders)([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let i=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),a=i.data;switch(a.status){case"in_progress":let c=5e3;if(s?.pollIntervalMs)c=s.pollIntervalMs;else{let l=i.response.headers.get("openai-poll-after-ms");if(l){let h=parseInt(l);isNaN(h)||(c=h)}}await(0,mm.sleep)(c);break;case"failed":case"completed":return a}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList((0,it.path)`/vector_stores/${n}/files/${e}/content`,Zl.Page,{...s,headers:(0,He.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}};qn.Files=Da});var Ja=u(Cn=>{"use strict";o();Object.defineProperty(Cn,"__esModule",{value:!0});Cn.VectorStores=void 0;var tu=A(),gm=_(),bm=tu.__importStar(Ha()),ym=Ha(),Pm=tu.__importStar(Wa()),vm=Wa(),eu=F(),ot=x(),Rn=C(),er=class extends gm.APIResource{constructor(){super(...arguments),this.files=new Pm.Files(this._client),this.fileBatches=new bm.FileBatches(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:(0,ot.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get((0,Rn.path)`/vector_stores/${e}`,{...t,headers:(0,ot.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post((0,Rn.path)`/vector_stores/${e}`,{body:t,...s,headers:(0,ot.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",eu.CursorPage,{query:e,...t,headers:(0,ot.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete((0,Rn.path)`/vector_stores/${e}`,{...t,headers:(0,ot.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList((0,Rn.path)`/vector_stores/${e}/search`,eu.Page,{body:t,method:"post",...s,headers:(0,ot.buildHeaders)([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}};Cn.VectorStores=er;er.Files=vm.Files;er.FileBatches=ym.FileBatches});var Xa=u(En=>{"use strict";o();Object.defineProperty(En,"__esModule",{value:!0});En.Videos=void 0;var wm=_(),Am=F(),Sm=x(),ru=ye(),Fn=C(),Va=class extends wm.APIResource{create(e,t){return this._client.post("/videos",(0,ru.maybeMultipartFormRequestOptions)({body:e,...t},this._client))}retrieve(e,t){return this._client.get((0,Fn.path)`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",Am.ConversationCursorPage,{query:e,...t})}delete(e,t){return this._client.delete((0,Fn.path)`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get((0,Fn.path)`/videos/${e}/content`,{query:t,...s,headers:(0,Sm.buildHeaders)([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post((0,Fn.path)`/videos/${e}/remix`,(0,ru.maybeMultipartFormRequestOptions)({body:t,...s},this._client))}};En.Videos=Va});var za=u(jn=>{"use strict";o();var at,su,Tn;Object.defineProperty(jn,"__esModule",{value:!0});jn.Webhooks=void 0;var xn=A(),Mn=fe(),Im=_(),Om=x(),Ka=class extends Im.APIResource{constructor(){super(...arguments),at.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if(typeof crypto>"u"||typeof crypto.subtle.importKey!="function"||typeof crypto.subtle.verify!="function")throw new Error("Webhook signature verification is only supported when the `crypto` global is defined");xn.__classPrivateFieldGet(this,at,"m",su).call(this,s);let i=(0,Om.buildHeaders)([t]).values,a=xn.__classPrivateFieldGet(this,at,"m",Tn).call(this,i,"webhook-signature"),c=xn.__classPrivateFieldGet(this,at,"m",Tn).call(this,i,"webhook-timestamp"),l=xn.__classPrivateFieldGet(this,at,"m",Tn).call(this,i,"webhook-id"),h=parseInt(c,10);if(isNaN(h))throw new Mn.InvalidWebhookSignatureError("Invalid webhook timestamp format");let g=Math.floor(Date.now()/1e3);if(g-h>n)throw new Mn.InvalidWebhookSignatureError("Webhook timestamp is too old");if(h>g+n)throw new Mn.InvalidWebhookSignatureError("Webhook timestamp is too new");let f=a.split(" ").map(y=>y.startsWith("v1,")?y.substring(3):y),b=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=l?`${l}.${c}.${e}`:`${c}.${e}`,S=await crypto.subtle.importKey("raw",b,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let y of f)try{let N=Buffer.from(y,"base64");if(await crypto.subtle.verify("HMAC",S,N,new TextEncoder().encode(d)))return}catch{continue}throw new Mn.InvalidWebhookSignatureError("The given webhook signature does not match the expected signature")}};jn.Webhooks=Ka;at=new WeakSet,su=function(e){if(typeof e!="string"||e.length===0)throw new Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},Tn=function(e,t){if(!e)throw new Error("Headers are required");let s=e.get(t);if(s==null)throw new Error(`Missing required header: ${t}`);return s}});var iu=u(P=>{"use strict";o();Object.defineProperty(P,"__esModule",{value:!0});P.Webhooks=P.Videos=P.VectorStores=P.Uploads=P.Responses=P.Realtime=P.Moderations=P.Models=P.Images=P.Graders=P.FineTuning=P.Files=P.Evals=P.Embeddings=P.Conversations=P.Containers=P.Completions=P.Beta=P.Batches=P.Audio=void 0;var nu=A();nu.__exportStar(ul(),P);nu.__exportStar(hl(),P);var qm=no();Object.defineProperty(P,"Audio",{enumerable:!0,get:function(){return qm.Audio}});var Rm=oo();Object.defineProperty(P,"Batches",{enumerable:!0,get:function(){return Rm.Batches}});var Cm=To();Object.defineProperty(P,"Beta",{enumerable:!0,get:function(){return Cm.Beta}});var Fm=ko();Object.defineProperty(P,"Completions",{enumerable:!0,get:function(){return Fm.Completions}});var Em=Bo();Object.defineProperty(P,"Containers",{enumerable:!0,get:function(){return Em.Containers}});var xm=Do();Object.defineProperty(P,"Conversations",{enumerable:!0,get:function(){return xm.Conversations}});var Mm=Vo();Object.defineProperty(P,"Embeddings",{enumerable:!0,get:function(){return Mm.Embeddings}});var Tm=Yo();Object.defineProperty(P,"Evals",{enumerable:!0,get:function(){return Tm.Evals}});var jm=ta();Object.defineProperty(P,"Files",{enumerable:!0,get:function(){return jm.Files}});var km=pa();Object.defineProperty(P,"FineTuning",{enumerable:!0,get:function(){return km.FineTuning}});var $m=ga();Object.defineProperty(P,"Graders",{enumerable:!0,get:function(){return $m.Graders}});var Nm=ya();Object.defineProperty(P,"Images",{enumerable:!0,get:function(){return Nm.Images}});var Gm=va();Object.defineProperty(P,"Models",{enumerable:!0,get:function(){return Gm.Models}});var Bm=Aa();Object.defineProperty(P,"Moderations",{enumerable:!0,get:function(){return Bm.Moderations}});var Lm=Ra();Object.defineProperty(P,"Realtime",{enumerable:!0,get:function(){return Lm.Realtime}});var Um=Na();Object.defineProperty(P,"Responses",{enumerable:!0,get:function(){return Um.Responses}});var Hm=La();Object.defineProperty(P,"Uploads",{enumerable:!0,get:function(){return Hm.Uploads}});var Dm=Ja();Object.defineProperty(P,"VectorStores",{enumerable:!0,get:function(){return Dm.VectorStores}});var Wm=Xa();Object.defineProperty(P,"Videos",{enumerable:!0,get:function(){return Wm.Videos}});var Jm=za();Object.defineProperty(P,"Webhooks",{enumerable:!0,get:function(){return Jm.Webhooks}})});var Nn=u($n=>{"use strict";o();var tc,rc,kn,ou;Object.defineProperty($n,"__esModule",{value:!0});$n.OpenAI=void 0;var we=A(),Vm=Dn(),Qa=Ae(),Xm=We(),Ya=sr(),Km=Qn(),Za=we.__importStar(pt()),zm=we.__importStar(dc()),Qm=we.__importStar(bc()),Ym=zn(),M=we.__importStar(me()),Zm=we.__importStar(F()),eg=we.__importStar(Pi()),$=we.__importStar(iu()),tg=Sr(),rg=oo(),sg=ko(),ng=Vo(),ig=ta(),og=ya(),ag=va(),cg=Aa(),lg=Xa(),ug=za(),dg=no(),hg=To(),fg=zi(),pg=Bo(),_g=Do(),mg=Yo(),gg=pa(),bg=ga(),yg=Ra(),Pg=Na(),vg=La(),wg=Ja(),Ag=Qn(),ec=x(),ct=Oo(),W=vt(),Sg=Ae(),w=class{constructor({baseURL:e=(0,ct.readEnv)("OPENAI_BASE_URL"),apiKey:t=(0,ct.readEnv)("OPENAI_API_KEY"),organization:s=(0,ct.readEnv)("OPENAI_ORG_ID")??null,project:n=(0,ct.readEnv)("OPENAI_PROJECT_ID")??null,webhookSecret:i=(0,ct.readEnv)("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(tc.add(this),kn.set(this,void 0),this.completions=new $.Completions(this),this.chat=new $.Chat(this),this.embeddings=new $.Embeddings(this),this.files=new $.Files(this),this.images=new $.Images(this),this.audio=new $.Audio(this),this.moderations=new $.Moderations(this),this.models=new $.Models(this),this.fineTuning=new $.FineTuning(this),this.graders=new $.Graders(this),this.vectorStores=new $.VectorStores(this),this.webhooks=new $.Webhooks(this),this.beta=new $.Beta(this),this.batches=new $.Batches(this),this.uploads=new $.Uploads(this),this.responses=new $.Responses(this),this.realtime=new $.Realtime(this),this.conversations=new $.Conversations(this),this.evals=new $.Evals(this),this.containers=new $.Containers(this),this.videos=new $.Videos(this),t===void 0)throw new M.OpenAIError("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");let c={apiKey:t,organization:s,project:n,webhookSecret:i,...a,baseURL:e||"https://api.openai.com/v1"};if(!c.dangerouslyAllowBrowser&&(0,Ag.isRunningInBrowser)())throw new M.OpenAIError(`It looks like you're running in a browser-like environment.

This is disabled by default, as it risks exposing your secret API credentials to attackers.
If you understand the risks and have appropriate mitigations in place,
you can set the \`dangerouslyAllowBrowser\` option to \`true\`, e.g.,

new OpenAI({ apiKey, dangerouslyAllowBrowser: true });

https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety
`);this.baseURL=c.baseURL,this.timeout=c.timeout??rc.DEFAULT_TIMEOUT,this.logger=c.logger??console;let l="warn";this.logLevel=l,this.logLevel=(0,W.parseLogLevel)(c.logLevel,"ClientOptions.logLevel",this)??(0,W.parseLogLevel)((0,ct.readEnv)("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??l,this.fetchOptions=c.fetchOptions,this.maxRetries=c.maxRetries??2,this.fetch=c.fetch??Za.getDefaultFetch(),we.__classPrivateFieldSet(this,kn,zm.FallbackEncoder,"f"),this._options=c,this.apiKey=typeof t=="string"?t:"Missing Key",this.organization=s,this.project=n,this.webhookSecret=i}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return(0,ec.buildHeaders)([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return Qm.stringify(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${Ym.VERSION}`}defaultIdempotencyKey(){return`stainless-node-retry-${(0,Vm.uuid4)()}`}makeStatusError(e,t,s,n){return M.APIError.generate(e,t,s,n)}async _callApiKey(){let e=this._options.apiKey;if(typeof e!="function")return!1;let t;try{t=await e()}catch(s){throw s instanceof M.OpenAIError?s:new M.OpenAIError(`Failed to get token from 'apiKey' function: ${s.message}`,{cause:s})}if(typeof t!="string"||!t)throw new M.OpenAIError(`Expected 'apiKey' function argument to return a string but it returned ${t}`);return this.apiKey=t,!0}buildURL(e,t,s){let n=!we.__classPrivateFieldGet(this,tc,"m",ou).call(this)&&s||this.baseURL,i=(0,Qa.isAbsoluteURL)(e)?new URL(e):new URL(n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return(0,Sg.isEmptyObj)(a)||(t={...a,...t}),typeof t=="object"&&t&&!Array.isArray(t)&&(i.search=this.stringifyQuery(t)),i.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(n=>({method:e,path:t,...n})))}request(e,t=null){return new tg.APIPromise(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,i=n.maxRetries??this.maxRetries;t==null&&(t=i),await this.prepareOptions(n);let{req:a,url:c,timeout:l}=await this.buildRequest(n,{retryCount:i-t});await this.prepareRequest(a,{url:c,options:n});let h="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),g=s===void 0?"":`, retryOf: ${s}`,f=Date.now();if((0,W.loggerFor)(this).debug(`[${h}] sending request`,(0,W.formatRequestDetails)({retryOfRequestLogID:s,method:n.method,url:c,options:n,headers:a.headers})),n.signal?.aborted)throw new M.APIUserAbortError;let b=new AbortController,d=await this.fetchWithTimeout(c,a,l,b).catch(Ya.castToError),S=Date.now();if(d instanceof globalThis.Error){let E=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new M.APIUserAbortError;let m=(0,Ya.isAbortError)(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return(0,W.loggerFor)(this).info(`[${h}] connection ${m?"timed out":"failed"} - ${E}`),(0,W.loggerFor)(this).debug(`[${h}] connection ${m?"timed out":"failed"} (${E})`,(0,W.formatRequestDetails)({retryOfRequestLogID:s,url:c,durationMs:S-f,message:d.message})),this.retryRequest(n,t,s??h);throw(0,W.loggerFor)(this).info(`[${h}] connection ${m?"timed out":"failed"} - error; no more retries left`),(0,W.loggerFor)(this).debug(`[${h}] connection ${m?"timed out":"failed"} (error; no more retries left)`,(0,W.formatRequestDetails)({retryOfRequestLogID:s,url:c,durationMs:S-f,message:d.message})),m?new M.APIConnectionTimeoutError:new M.APIConnectionError({cause:d})}let y=[...d.headers.entries()].filter(([E])=>E==="x-request-id").map(([E,m])=>", "+E+": "+JSON.stringify(m)).join(""),N=`[${h}${g}${y}] ${a.method} ${c} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${S-f}ms`;if(!d.ok){let E=await this.shouldRetry(d);if(t&&E){let k=`retrying, ${t} attempts remaining`;return await Za.CancelReadableStream(d.body),(0,W.loggerFor)(this).info(`${N} - ${k}`),(0,W.loggerFor)(this).debug(`[${h}] response error (${k})`,(0,W.formatRequestDetails)({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:S-f})),this.retryRequest(n,t,s??h,d.headers)}let m=E?"error; no more retries left":"error; not retryable";(0,W.loggerFor)(this).info(`${N} - ${m}`);let J=await d.text().catch(k=>(0,Ya.castToError)(k).message),T=(0,Qa.safeJSON)(J),ne=T?void 0:J;throw(0,W.loggerFor)(this).debug(`[${h}] response error (${m})`,(0,W.formatRequestDetails)({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:ne,durationMs:Date.now()-f})),this.makeStatusError(d.status,T,ne,d.headers)}return(0,W.loggerFor)(this).info(N),(0,W.loggerFor)(this).debug(`[${h}] response start`,(0,W.formatRequestDetails)({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:S-f})),{response:d,options:n,controller:b,requestLogID:h,retryOfRequestLogID:s,startTime:f}}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}requestAPIList(e,t){let s=this.makeRequest(t,null,void 0);return new Zm.PagePromise(this,s,e)}async fetchWithTimeout(e,t,s,n){let{signal:i,method:a,...c}=t||{};i&&i.addEventListener("abort",()=>n.abort());let l=setTimeout(()=>n.abort(),s),h=globalThis.ReadableStream&&c.body instanceof globalThis.ReadableStream||typeof c.body=="object"&&c.body!==null&&Symbol.asyncIterator in c.body,g={signal:n.signal,...h?{duplex:"half"}:{},method:"GET",...c};a&&(g.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,g)}finally{clearTimeout(l)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,s,n){let i,a=n?.get("retry-after-ms");if(a){let l=parseFloat(a);Number.isNaN(l)||(i=l)}let c=n?.get("retry-after");if(c&&!i){let l=parseFloat(c);Number.isNaN(l)?i=Date.parse(c)-Date.now():i=l*1e3}if(!(i&&0<=i&&i<60*1e3)){let l=e.maxRetries??this.maxRetries;i=this.calculateDefaultRetryTimeoutMillis(t,l)}return await(0,Xm.sleep)(i),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){let i=t-e,a=Math.min(.5*Math.pow(2,i),8),c=1-Math.random()*.25;return a*c*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:i,query:a,defaultBaseURL:c}=s,l=this.buildURL(i,a,c);"timeout"in s&&(0,Qa.validatePositiveInteger)("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:h,body:g}=this.buildBody({options:s}),f=await this.buildHeaders({options:e,method:n,bodyHeaders:h,retryCount:t});return{req:{method:n,headers:f,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&g instanceof globalThis.ReadableStream&&{duplex:"half"},...g&&{body:g},...this.fetchOptions??{},...s.fetchOptions??{}},url:l,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let i={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey);let a=(0,ec.buildHeaders)([i,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...(0,Km.getPlatformHeaders)(),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(a),a.values}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=(0,ec.buildHeaders)([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:Za.ReadableStreamFrom(e)}:we.__classPrivateFieldGet(this,kn,"f").call(this,{body:e,headers:s})}};$n.OpenAI=w;rc=w,kn=new WeakMap,tc=new WeakSet,ou=function(){return this.baseURL!=="https://api.openai.com/v1"};w.OpenAI=rc;w.DEFAULT_TIMEOUT=6e5;w.OpenAIError=M.OpenAIError;w.APIError=M.APIError;w.APIConnectionError=M.APIConnectionError;w.APIConnectionTimeoutError=M.APIConnectionTimeoutError;w.APIUserAbortError=M.APIUserAbortError;w.NotFoundError=M.NotFoundError;w.ConflictError=M.ConflictError;w.RateLimitError=M.RateLimitError;w.BadRequestError=M.BadRequestError;w.AuthenticationError=M.AuthenticationError;w.InternalServerError=M.InternalServerError;w.PermissionDeniedError=M.PermissionDeniedError;w.UnprocessableEntityError=M.UnprocessableEntityError;w.InvalidWebhookSignatureError=M.InvalidWebhookSignatureError;w.toFile=eg.toFile;w.Completions=sg.Completions;w.Chat=fg.Chat;w.Embeddings=ng.Embeddings;w.Files=ig.Files;w.Images=og.Images;w.Audio=dg.Audio;w.Moderations=cg.Moderations;w.Models=ag.Models;w.FineTuning=gg.FineTuning;w.Graders=bg.Graders;w.VectorStores=wg.VectorStores;w.Webhooks=ug.Webhooks;w.Beta=hg.Beta;w.Batches=rg.Batches;w.Uploads=vg.Uploads;w.Responses=Pg.Responses;w.Realtime=yg.Realtime;w.Conversations=_g.Conversations;w.Evals=mg.Evals;w.Containers=pg.Containers;w.Videos=lg.Videos});var au=u(Bn=>{"use strict";o();Object.defineProperty(Bn,"__esModule",{value:!0});Bn.AzureOpenAI=void 0;var Ig=A(),Og=x(),tr=Ig.__importStar(fe()),Gn=Ut(),qg=Nn(),sc=class extends qg.OpenAI{constructor({baseURL:e=(0,Gn.readEnv)("OPENAI_BASE_URL"),apiKey:t=(0,Gn.readEnv)("AZURE_OPENAI_API_KEY"),apiVersion:s=(0,Gn.readEnv)("OPENAI_API_VERSION"),endpoint:n,deployment:i,azureADTokenProvider:a,dangerouslyAllowBrowser:c,...l}={}){if(!s)throw new tr.OpenAIError("The OPENAI_API_VERSION environment variable is missing or empty; either provide it, or instantiate the AzureOpenAI client with an apiVersion option, like new AzureOpenAI({ apiVersion: 'My API Version' }).");if(typeof a=="function"&&(c=!0),!a&&!t)throw new tr.OpenAIError("Missing credentials. Please pass one of `apiKey` and `azureADTokenProvider`, or set the `AZURE_OPENAI_API_KEY` environment variable.");if(a&&t)throw new tr.OpenAIError("The `apiKey` and `azureADTokenProvider` arguments are mutually exclusive; only one can be passed at a time.");if(l.defaultQuery={...l.defaultQuery,"api-version":s},e){if(n)throw new tr.OpenAIError("baseURL and endpoint are mutually exclusive")}else{if(n||(n=process.env.AZURE_OPENAI_ENDPOINT),!n)throw new tr.OpenAIError("Must provide one of the `baseURL` or `endpoint` arguments, or the `AZURE_OPENAI_ENDPOINT` environment variable");e=`${n}/openai`}super({apiKey:a??t,baseURL:e,...l,...c!==void 0?{dangerouslyAllowBrowser:c}:{}}),this.apiVersion="",this.apiVersion=s,this.deploymentName=i}async buildRequest(e,t={}){if(Rg.has(e.path)&&e.method==="post"&&e.body!==void 0){if(!(0,Gn.isObj)(e.body))throw new Error("Expected request body to be an object");let s=this.deploymentName||e.body.model||e.__metadata?.model;s!==void 0&&!this.baseURL.includes("/deployments")&&(e.path=`/deployments/${s}${e.path}`)}return super.buildRequest(e,t)}async authHeaders(e){return typeof this._options.apiKey=="string"?(0,Og.buildHeaders)([{"api-key":this.apiKey}]):super.authHeaders(e)}};Bn.AzureOpenAI=sc;var Rg=new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations","/batches","/images/edits"])});var lu=u((v,cu)=>{"use strict";o();v=cu.exports=function(...r){return new v.default(...r)};Object.defineProperty(v,"__esModule",{value:!0});v.AzureOpenAI=v.InvalidWebhookSignatureError=v.UnprocessableEntityError=v.PermissionDeniedError=v.InternalServerError=v.AuthenticationError=v.BadRequestError=v.RateLimitError=v.ConflictError=v.NotFoundError=v.APIUserAbortError=v.APIConnectionTimeoutError=v.APIConnectionError=v.APIError=v.OpenAIError=v.PagePromise=v.OpenAI=v.APIPromise=v.toFile=v.default=void 0;var Cg=Nn();Object.defineProperty(v,"default",{enumerable:!0,get:function(){return Cg.OpenAI}});var Fg=Pi();Object.defineProperty(v,"toFile",{enumerable:!0,get:function(){return Fg.toFile}});var Eg=Sr();Object.defineProperty(v,"APIPromise",{enumerable:!0,get:function(){return Eg.APIPromise}});var xg=Nn();Object.defineProperty(v,"OpenAI",{enumerable:!0,get:function(){return xg.OpenAI}});var Mg=F();Object.defineProperty(v,"PagePromise",{enumerable:!0,get:function(){return Mg.PagePromise}});var se=me();Object.defineProperty(v,"OpenAIError",{enumerable:!0,get:function(){return se.OpenAIError}});Object.defineProperty(v,"APIError",{enumerable:!0,get:function(){return se.APIError}});Object.defineProperty(v,"APIConnectionError",{enumerable:!0,get:function(){return se.APIConnectionError}});Object.defineProperty(v,"APIConnectionTimeoutError",{enumerable:!0,get:function(){return se.APIConnectionTimeoutError}});Object.defineProperty(v,"APIUserAbortError",{enumerable:!0,get:function(){return se.APIUserAbortError}});Object.defineProperty(v,"NotFoundError",{enumerable:!0,get:function(){return se.NotFoundError}});Object.defineProperty(v,"ConflictError",{enumerable:!0,get:function(){return se.ConflictError}});Object.defineProperty(v,"RateLimitError",{enumerable:!0,get:function(){return se.RateLimitError}});Object.defineProperty(v,"BadRequestError",{enumerable:!0,get:function(){return se.BadRequestError}});Object.defineProperty(v,"AuthenticationError",{enumerable:!0,get:function(){return se.AuthenticationError}});Object.defineProperty(v,"InternalServerError",{enumerable:!0,get:function(){return se.InternalServerError}});Object.defineProperty(v,"PermissionDeniedError",{enumerable:!0,get:function(){return se.PermissionDeniedError}});Object.defineProperty(v,"UnprocessableEntityError",{enumerable:!0,get:function(){return se.UnprocessableEntityError}});Object.defineProperty(v,"InvalidWebhookSignatureError",{enumerable:!0,get:function(){return se.InvalidWebhookSignatureError}});var Tg=au();Object.defineProperty(v,"AzureOpenAI",{enumerable:!0,get:function(){return Tg.AzureOpenAI}})});o();var jg=lu(),kg=new jg({apiKey:process.env.OPENAI_API_KEY});exports.handler=async r=>{if(r.requestContext?.http?.method==="OPTIONS")return rr(200,{ok:!0});try{if(!process.env.OPENAI_API_KEY)return rr(500,{error:"OPENAI_API_KEY is not configured in the function environment."});let e=typeof r.body=="string"?JSON.parse(r.body):r.body||{},t=e.resumeText||"",s=e.jobDescription||"",n=e.language||"en";if(!t.trim())return rr(400,{error:"resumeText is required."});let i=n==="es"?"Eres un experto en redacci\xF3n de curr\xEDculums. Reescribe el curr\xEDculum del usuario en un formato claro, profesional y enfocado en logros. Usa vi\xF1etas cuando sea apropiado. Mant\xE9n el contenido ATS-friendly.":"You are an expert resume writer. Rewrite the user's resume into a clear, professional, achievement-focused format. Use bullet points where appropriate. Keep it ATS-friendly.",a=(n==="es"?`Curr\xEDculum original:

`:`Original resume:

`)+t+`

`+(s?(n==="es"?`Descripci\xF3n del puesto objetivo:

`:`Target job description:

`)+s+`

`:"")+(n==="es"?"Reescribe el curr\xEDculum para que se alinee con el puesto (si se proporcion\xF3), manteniendo la informaci\xF3n ver\xEDdica. Devu\xE9lvelo en texto plano.":"Rewrite the resume so it aligns with the target role (if provided), keeping all facts true. Return plain text only."),l=(await kg.chat.completions.create({model:"gpt-4.1-mini",messages:[{role:"system",content:i},{role:"user",content:a}],temperature:.4})).choices?.[0]?.message?.content?.trim()||(n==="es"?"No se pudo generar una respuesta.":"No response generated.");return rr(200,{rewrittenText:l})}catch(e){return console.error("rewriteResume error",e),rr(500,{error:"Internal server error.",details:e.message||String(e)})}};function rr(r,e){return{statusCode:r,headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Headers":"*","Access-Control-Allow-Methods":"OPTIONS,POST"},body:JSON.stringify(e)}}
//# sourceMappingURL=index.mjs.map
