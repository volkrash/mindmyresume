{
  "version": 3,
  "sources": ["../../../../node_modules/@aws-amplify/backend-function/src/lambda-shims/cjs_shim.ts", "../../../../amplify/functions/rewriteResume/handler.js"],
  "sourcesContent": ["import { createRequire } from 'node:module';\nimport path from 'node:path';\nimport url from 'node:url';\nglobal.require = createRequire(import.meta.url);\nglobal.__filename = url.fileURLToPath(import.meta.url);\nglobal.__dirname = path.dirname(__filename);\n", "const https = require(\"https\");\n\nexports.handler = async (event) => {\n    if (\n        event.requestContext &&\n        event.requestContext.http &&\n        event.requestContext.http.method === \"OPTIONS\"\n    ) {\n        return cors(200, { ok: true });\n    }\n\n    try {\n        const apiKey = process.env.OPENAI_API_KEY;\n        if (!apiKey) {\n            return cors(500, { error: \"OPENAI_API_KEY not set\" });\n        }\n\n        let body = {};\n        if (typeof event.body === \"string\") {\n            body = JSON.parse(event.body);\n        }\n\n        const resumeText = body.resumeText || \"\";\n        const jobDescription = body.jobDescription || \"\";\n        const language = body.language || \"en\";\n\n        if (!resumeText.trim()) {\n            return cors(400, { error: \"resumeText is required\" });\n        }\n\n        const systemPrompt =\n            language === \"es\"\n                ? \"Eres un experto en redacci\u00F3n de curr\u00EDculums. Reescribe el curr\u00EDculum con formato profesional, logros y optimizaci\u00F3n ATS.\"\n                : \"You are an expert resume writer. Rewrite with professional structure, bullet points, and ATS optimization.\";\n\n        const userPrompt = `${resumeText}\\n\\nJob description:\\n${jobDescription}`;\n\n        const payload = JSON.stringify({\n            model: \"gpt-4.1-mini\",\n            messages: [\n                { role: \"system\", content: systemPrompt },\n                { role: \"user\", content: userPrompt }\n            ]\n        });\n\n        const result = await callOpenAI(payload, apiKey);\n\n        return cors(200, { rewrittenText: result });\n\n    } catch (error) {\n        return cors(500, { error: error.message || String(error) });\n    }\n};\n\nfunction callOpenAI(payload, apiKey) {\n    return new Promise((resolve, reject) => {\n        const options = {\n            hostname: \"api.openai.com\",\n            path: \"/v1/chat/completions\",\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"Authorization\": `Bearer ${apiKey}`,\n                \"Content-Length\": Buffer.byteLength(payload)\n            }\n        };\n\n        const req = https.request(options, res => {\n            let data = \"\";\n            res.on(\"data\", chunk => data += chunk);\n            res.on(\"end\", () => {\n                try {\n                    const json = JSON.parse(data);\n\n                    const text =\n                        json.choices &&\n                        json.choices[0] &&\n                        json.choices[0].message &&\n                        json.choices[0].message.content\n                            ? json.choices[0].message.content\n                            : \"No response generated\";\n\n                    resolve(text);\n                } catch (err) {\n                    reject(err);\n                }\n            });\n        });\n\n        req.on(\"error\", reject);\n        req.write(payload);\n        req.end();\n    });\n}\n\nfunction cors(statusCode, body) {\n    return {\n        statusCode,\n        headers: {\n            \"Content-Type\": \"application/json\",\n            \"Access-Control-Allow-Origin\": \"*\",\n            \"Access-Control-Allow-Headers\": \"*\",\n            \"Access-Control-Allow-Methods\": \"OPTIONS,POST\"\n        },\n        body: JSON.stringify(body)\n    };\n}\n"],
  "mappings": ";yPAAA,OAAS,iBAAAA,MAAqB,cAC9B,OAAOC,MAAU,YACjB,OAAOC,MAAS,WAChB,OAAO,QAAUF,EAAc,YAAY,GAAG,EAC9C,OAAO,WAAaE,EAAI,cAAc,YAAY,GAAG,EACrD,OAAO,UAAYD,EAAK,QAAQ,UAAU,ECL1C,IAAME,EAAQ,EAAQ,OAAO,EAE7B,QAAQ,QAAU,MAAOC,GAAU,CAC/B,GACIA,EAAM,gBACNA,EAAM,eAAe,MACrBA,EAAM,eAAe,KAAK,SAAW,UAErC,OAAOC,EAAK,IAAK,CAAE,GAAI,EAAK,CAAC,EAGjC,GAAI,CACA,IAAMC,EAAS,QAAQ,IAAI,eAC3B,GAAI,CAACA,EACD,OAAOD,EAAK,IAAK,CAAE,MAAO,wBAAyB,CAAC,EAGxD,IAAIE,EAAO,CAAC,EACR,OAAOH,EAAM,MAAS,WACtBG,EAAO,KAAK,MAAMH,EAAM,IAAI,GAGhC,IAAMI,EAAaD,EAAK,YAAc,GAChCE,EAAiBF,EAAK,gBAAkB,GACxCG,EAAWH,EAAK,UAAY,KAElC,GAAI,CAACC,EAAW,KAAK,EACjB,OAAOH,EAAK,IAAK,CAAE,MAAO,wBAAyB,CAAC,EAGxD,IAAMM,EACFD,IAAa,KACP,uIACA,6GAEJE,EAAa,GAAGJ,CAAU;AAAA;AAAA;AAAA,EAAyBC,CAAc,GAEjEI,EAAU,KAAK,UAAU,CAC3B,MAAO,eACP,SAAU,CACN,CAAE,KAAM,SAAU,QAASF,CAAa,EACxC,CAAE,KAAM,OAAQ,QAASC,CAAW,CACxC,CACJ,CAAC,EAEKE,EAAS,MAAMC,EAAWF,EAASP,CAAM,EAE/C,OAAOD,EAAK,IAAK,CAAE,cAAeS,CAAO,CAAC,CAE9C,OAASE,EAAO,CACZ,OAAOX,EAAK,IAAK,CAAE,MAAOW,EAAM,SAAW,OAAOA,CAAK,CAAE,CAAC,CAC9D,CACJ,EAEA,SAASD,EAAWF,EAASP,EAAQ,CACjC,OAAO,IAAI,QAAQ,CAACW,EAASC,IAAW,CACpC,IAAMC,EAAU,CACZ,SAAU,iBACV,KAAM,uBACN,OAAQ,OACR,QAAS,CACL,eAAgB,mBAChB,cAAiB,UAAUb,CAAM,GACjC,iBAAkB,OAAO,WAAWO,CAAO,CAC/C,CACJ,EAEMO,EAAMjB,EAAM,QAAQgB,EAASE,GAAO,CACtC,IAAIC,EAAO,GACXD,EAAI,GAAG,OAAQE,GAASD,GAAQC,CAAK,EACrCF,EAAI,GAAG,MAAO,IAAM,CAChB,GAAI,CACA,IAAMG,EAAO,KAAK,MAAMF,CAAI,EAEtBG,EACFD,EAAK,SACLA,EAAK,QAAQ,CAAC,GACdA,EAAK,QAAQ,CAAC,EAAE,SAChBA,EAAK,QAAQ,CAAC,EAAE,QAAQ,QAClBA,EAAK,QAAQ,CAAC,EAAE,QAAQ,QACxB,wBAEVP,EAAQQ,CAAI,CAChB,OAASC,EAAK,CACVR,EAAOQ,CAAG,CACd,CACJ,CAAC,CACL,CAAC,EAEDN,EAAI,GAAG,QAASF,CAAM,EACtBE,EAAI,MAAMP,CAAO,EACjBO,EAAI,IAAI,CACZ,CAAC,CACL,CAEA,SAASf,EAAKsB,EAAYpB,EAAM,CAC5B,MAAO,CACH,WAAAoB,EACA,QAAS,CACL,eAAgB,mBAChB,8BAA+B,IAC/B,+BAAgC,IAChC,+BAAgC,cACpC,EACA,KAAM,KAAK,UAAUpB,CAAI,CAC7B,CACJ",
  "names": ["createRequire", "path", "url", "https", "event", "cors", "apiKey", "body", "resumeText", "jobDescription", "language", "systemPrompt", "userPrompt", "payload", "result", "callOpenAI", "error", "resolve", "reject", "options", "req", "res", "data", "chunk", "json", "text", "err", "statusCode"]
}
